
<!doctype html>
<html lang="pt" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentação técnica completa do sistema VoiceCap - Captura de informações por voz com IA híbrida multi-tenant">
      
      
        <meta name="author" content="Equipe VoiceCap">
      
      
        <link rel="canonical" href="https://voicecap.com.br/DONE_3_04_01_c4_component_backend/">
      
      
        <link rel="prev" href="../DONE_3_03_c4_container/">
      
      
        <link rel="next" href="../DONE_3_04_02_fluxos_validacao/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>[32] DIAGRAMA C4 NÍVEL 3 (COMPONENT - BACKEND) - VoiceCap - VoiceCap - Documentação Técnica Completa</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#diagrama-c4-nivel-3-component-backend-voicecap" class="md-skip">
          Pular para conteúdo
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabeçalho">
    <a href=".." title="VoiceCap - Documentação Técnica Completa" class="md-header__button md-logo" aria-label="VoiceCap - Documentação Técnica Completa" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            VoiceCap - Documentação Técnica Completa
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              [32] DIAGRAMA C4 NÍVEL 3 (COMPONENT - BACKEND) - VoiceCap
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Alternar para modo escuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Alternar para modo escuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Alternar para modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Alternar para modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Buscar" placeholder="Buscar" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Pesquisar">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Compartilhar" aria-label="Compartilhar" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Limpar" aria-label="Limpar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando busca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Abas" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Início

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../DONE_1_01_problem_statement/" class="md-tabs__link">
          
  
  
  1. Contexto Estratégico do Projeto

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../DONE_2_01_analise_stakeholders_contexto/" class="md-tabs__link">
          
  
  
  2. Requisitos e Especificações

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../DONE_3_01_00_INDICE_MASTER/" class="md-tabs__link">
          
  
  
  3. Arquitetura do Sistema

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../DONE_4_01_00_INDICE/" class="md-tabs__link">
          
  
  
  4. Design de Interface e Interação

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../print_page/" class="md-tabs__link">
        
  
  
    
  
  Imprimir Documentação Completa

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navegação" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="VoiceCap - Documentação Técnica Completa" class="md-nav__button md-logo" aria-label="VoiceCap - Documentação Técnica Completa" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    VoiceCap - Documentação Técnica Completa
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Início
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    1. Contexto Estratégico do Projeto
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    1. Contexto Estratégico do Projeto
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    1.1 Descoberta do Problema
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    1.1 Descoberta do Problema
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_1_01_problem_statement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [1] PROBLEM STATEMENT & ANÁLISE DO PROBLEMA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_1_02_stakeholders_personas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [2] STAKEHOLDERS & PERSONAS PRIMÁRIAS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_1_03_proposta_valor_bmc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [3] PROPOSTA DE VALOR & BUSINESS MODEL CANVAS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    1.2 Planejamento Estratégico
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    1.2 Planejamento Estratégico
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_1_04_okrs_kpis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [4] OKRs, KPIs E MÉTRICAS DE SUCESSO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_1_05_restricoes_negocio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [5] RESTRIÇÕES DE NEGÓCIO (BUDGET/PRAZO/COMPLIANCE)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_1_06_escopo_mvp_futuro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [6] ESCOPO MVP vs FUTURO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    1.3 Validação de Viabilidade
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    1.3 Validação de Viabilidade
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_1_07_riscos_viabilidade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [7] RISCOS & ANÁLISE DE VIABILIDADE
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_1_08_documento_final_saidas_camada2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [8] DOCUMENTO FINAL: CONTEXTO ESTRATÉGICO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2. Requisitos e Especificações
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    2. Requisitos e Especificações
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2.1 Análise de Stakeholders e Backlog
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    2.1 Análise de Stakeholders e Backlog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_2_01_analise_stakeholders_contexto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [9] CONVERSA 1: ANÁLISE DE STAKEHOLDERS & CONTEXTO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_2_02_product_backlog_inicial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [10] CONVERSA 2: PRODUCT BACKLOG INICIAL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_2_03_user_stories_parte1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [11] CONVERSA 3: USER STORIES (PARTE 1/2)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2.2 Especificação Funcional Completa
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    2.2 Especificação Funcional Completa
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_2_04_user_stories_parte2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [12] CONVERSA 4: USER STORIES (PARTE 2/2)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_2_05_wireframes_ascii_preliminares/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [13] CONVERSA 5: WIREFRAMES ASCII PRELIMINARES
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_2_06_casos_de_uso/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [14] CONVERSA 6: CASOS DE USO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_2_07_criterios_aceitacao_regras_negocio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [15] CONVERSA 7: CRITÉRIOS DE ACEITAÇÃO & REGRAS DE NEGÓCIO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2.3 Requisitos Não-Funcionais
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    2.3 Requisitos Não-Funcionais
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_2_08_rnf_performance_escalabilidade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [16] CONVERSA 8: RNF - PERFORMANCE & ESCALABILIDADE
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_2_09_rnf_seguranca_disponibilidade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [17] CONVERSA 9: RNF - SEGURANÇA & DISPONIBILIDADE
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_2_10_rnf_usabilidade_compatibilidade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [18] CONVERSA 10: RNF - USABILIDADE & COMPATIBILIDADE
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    2.4 Priorização e Rastreabilidade
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    2.4 Priorização e Rastreabilidade
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_2_11_priorizacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [19] PRIORIZAÇÃO DE REQUISITOS (MoSCoW + RICE)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_2_12_estimativas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [20] ESTIMATIVAS DE ESFORÇO (STORY POINTS)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_2_13_matriz_rastreabilidade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [21] MATRIZ DE RASTREABILIDADE E DOCUMENTO CONSOLIDADO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    3. Arquitetura do Sistema
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    3. Arquitetura do Sistema
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    3.1 Decisões Arquiteturais
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    3.1 Decisões Arquiteturais
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_01_00_INDICE_MASTER/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [22] DECISÃO DE ARQUITETURA VOICECAP - ÍNDICE MASTER
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_01_01_analise_contexto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [23] CONVERSA 1: DECISÃO DE ARQUITETURA - PARTE 1/7
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_01_02_padroes_candidatos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [24] CONVERSA 1: DECISÃO DE ARQUITETURA - PARTE 2/7
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_01_03_matriz_decisao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [25] CONVERSA 1: DECISÃO DE ARQUITETURA - PARTE 3/7
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_01_04_recomendacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [26] CONVERSA 1: DECISÃO DE ARQUITETURA - PARTE 4/7
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_01_05_tradeoffs_riscos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [27] CONVERSA 1: DECISÃO DE ARQUITETURA - PARTE 5/7
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_01_06_roadmap_principios/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [28] CONVERSA 1: DECISÃO DE ARQUITETURA - PARTE 6/7
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_01_07_alternativas_adr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [29] CONVERSA 1: DECISÃO DE ARQUITETURA - PARTE 7/7
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    3.2 Diagramação C4 Model
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    3.2 Diagramação C4 Model
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_02_c4_context/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [30] DIAGRAMA C4 NÍVEL 1 (SYSTEM CONTEXT) - VoiceCap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_03_c4_container/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [31] DIAGRAMA C4 NÍVEL 2 (CONTAINER) - VoiceCap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    [32] DIAGRAMA C4 NÍVEL 3 (COMPONENT - BACKEND) - VoiceCap
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    [32] DIAGRAMA C4 NÍVEL 3 (COMPONENT - BACKEND) - VoiceCap
  

    
  </span>
  
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="Nesta página">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Nesta página
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#metadados" class="md-nav__link">
    <span class="md-ellipsis">
      
        METADADOS
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-diagrama-c4-component-mermaid" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. DIAGRAMA C4 COMPONENT (MERMAID)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-padrao-arquitetural-aplicado" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. PADRÃO ARQUITETURAL APLICADO
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. PADRÃO ARQUITETURAL APLICADO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#padrao-escolhido-hexagonal-architecture-ports-adapters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Padrão Escolhido: Hexagonal Architecture (Ports &amp; Adapters)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camadas-da-hexagonal-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Camadas da Hexagonal Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Camadas da Hexagonal Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#camada-1-domain-core-nucleo-regras-de-negocio-puras" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 1: DOMAIN CORE (Núcleo - Regras de Negócio Puras)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camada-2-application-layer-orquestracao-application-ports" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 2: APPLICATION LAYER (Orquestração + Application Ports)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camada-3-infrastructure-layer-implementacoes-tecnicas-adapters" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 3: INFRASTRUCTURE LAYER (Implementações Técnicas - Adapters)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camada-4-presentation-layer-interface-http-frameworks" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 4: PRESENTATION LAYER (Interface HTTP - Frameworks)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regras-de-dependencia-dependency-rule" class="md-nav__link">
    <span class="md-ellipsis">
      
        Regras de Dependência (Dependency Rule)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-componentes-por-camada" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. COMPONENTES POR CAMADA
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. COMPONENTES POR CAMADA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#camada-1-domain-core" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 1: DOMAIN CORE
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CAMADA 1: DOMAIN CORE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entities-entidades-com-identidade-e-regras-de-negocio" class="md-nav__link">
    <span class="md-ellipsis">
      
        Entities (Entidades com Identidade e Regras de Negócio)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#value-objects-objetos-imutaveis-sem-identidade" class="md-nav__link">
    <span class="md-ellipsis">
      
        Value Objects (Objetos Imutáveis sem Identidade)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repository-interfaces-domain-ports-contratos-de-persistencia" class="md-nav__link">
    <span class="md-ellipsis">
      
        Repository Interfaces (Domain Ports - Contratos de Persistência)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-services-logica-de-negocio-complexa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Domain Services (Lógica de Negócio Complexa)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camada-2-application-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 2: APPLICATION LAYER
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CAMADA 2: APPLICATION LAYER">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-cases-1-por-funcionalidade-principal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Cases (1 por funcionalidade principal)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-ports-interfaces-para-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Application Ports (Interfaces para Infrastructure)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dtos-data-transfer-objects" class="md-nav__link">
    <span class="md-ellipsis">
      
        DTOs (Data Transfer Objects)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camada-3-infrastructure-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 3: INFRASTRUCTURE LAYER
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CAMADA 3: INFRASTRUCTURE LAYER">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ia-adapters-implementam-application-ports" class="md-nav__link">
    <span class="md-ellipsis">
      
        IA Adapters (Implementam Application Ports)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-adapters-implementam-application-ports" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Adapters (Implementam Application Ports)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repository-implementations-implementam-domain-ports" class="md-nav__link">
    <span class="md-ellipsis">
      
        Repository Implementations (Implementam Domain Ports)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-adapters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration Adapters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camada-4-presentation-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 4: PRESENTATION LAYER
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CAMADA 4: PRESENTATION LAYER">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#controllers-endpoints-rest-fastify-routers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Controllers (Endpoints REST - Fastify Routers)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#middlewares" class="md-nav__link">
    <span class="md-ellipsis">
      
        Middlewares
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schemas-validacao-requestresponse-zod" class="md-nav__link">
    <span class="md-ellipsis">
      
        Schemas (Validação Request/Response - Zod)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-matriz-de-dependencias" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. MATRIZ DE DEPENDÊNCIAS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. MATRIZ DE DEPENDÊNCIAS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#regra-da-hexagonal-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Regra da Hexagonal Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explicacao-detalhada" class="md-nav__link">
    <span class="md-ellipsis">
      
        Explicação Detalhada
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exemplos-de-codigo" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exemplos de Código
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exemplos de Código">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#correto-application-importa-domain" class="md-nav__link">
    <span class="md-ellipsis">
      
        ✅ CORRETO: Application importa Domain
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correto-infrastructure-implementa-application-port" class="md-nav__link">
    <span class="md-ellipsis">
      
        ✅ CORRETO: Infrastructure implementa Application Port
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correto-presentation-injeta-dependencias-via-di-container" class="md-nav__link">
    <span class="md-ellipsis">
      
        ✅ CORRETO: Presentation injeta dependências via DI Container
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errado-domain-importa-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ ERRADO: Domain importa Infrastructure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errado-application-importa-infrastructure-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ ERRADO: Application importa Infrastructure Adapter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errado-presentation-importa-adapter-concreto" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ ERRADO: Presentation importa Adapter concreto
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validacao-da-matriz" class="md-nav__link">
    <span class="md-ellipsis">
      
        Validação da Matriz
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_04_02_fluxos_validacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [33] DIAGRAMA C4 COMPONENT - FLUXOS E VALIDAÇÃO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    3.3 Modelagem de Dados
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    3.3 Modelagem de Dados
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_05_01_diagrama_er/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [34] DIAGRAMA ER (ENTITY-RELATIONSHIP) - VoiceCap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_05_02_scripts_ddl_migrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [35] SCRIPTS SQL DDL E MIGRATIONS - VoiceCap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    3.4 Estrutura de Código Backend
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    3.4 Estrutura de Código Backend
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_06_01_estrutura_pastas_backend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [36] ESTRUTURA DE PASTAS - BACKEND - VoiceCap (Parte 1/2)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_06_02_exemplos_codigo_validacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [37] ESTRUTURA DE PASTAS - BACKEND - VoiceCap (Parte 2/2)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    3.5 Estrutura de Código Frontend
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    3.5 Estrutura de Código Frontend
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_07_01_estrutura_pastas_frontend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [38] ESTRUTURA DE PASTAS - FRONTEND - VoiceCap (Parte 1/2)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_07_02_exemplos_codigo_validacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [39] ESTRUTURA DE PASTAS - FRONTEND - VoiceCap (Parte 2/2)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    3.6 Dependências e Tecnologias
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    3.6 Dependências e Tecnologias
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_08_01_matriz_backend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [40] MATRIZ DE DEPENDÊNCIAS - BACKEND (Parte 1/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_08_02_matriz_frontend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [41] MATRIZ DE DEPENDÊNCIAS - FRONTEND (Parte 2/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_08_03_comunicacao_validacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [42] COMUNICAÇÃO & VALIDAÇÃO (Parte 3/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    3.7 Padrões de Domínio (DDD)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    3.7 Padrões de Domínio (DDD)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_09_01_padroes_basicos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [43] PADRÕES DE DOMAIN (DDD) - PARTE 1: PADRÕES BÁSICOS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_09_02_padroes_avancados/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [44] PADRÕES DE DOMAIN (DDD) - PARTE 2: PADRÕES AVANÇADOS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_09_03_templates_validacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [45] PADRÕES DE DOMAIN (DDD) - PARTE 3: TEMPLATES E VALIDAÇÃO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          <label class="md-nav__link" for="__nav_4_8" id="__nav_4_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    3.8 Especificação de APIs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    3.8 Especificação de APIs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_10_01_fundamentos_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [46] PADRÕES DE API REST - PARTE 1: FUNDAMENTOS API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_10_02_controllers_seguranca/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [47] PADRÕES DE API REST - PARTE 2: CONTROLLERS E SEGURANÇA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_10_03_recursos_completos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [48] PADRÕES DE API REST - PARTE 3: RECURSOS COMPLETOS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9" >
        
          
          <label class="md-nav__link" for="__nav_4_9" id="__nav_4_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    3.9 Estratégia de Testes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    3.9 Estratégia de Testes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_11_01_fundamentos_estrategia_testes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [49] ESTRATÉGIA DE TESTES - PARTE 1: FUNDAMENTOS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_11_02_exemplos_rnfs_validacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [50] ESTRATÉGIA DE TESTES - PARTE 2: EXEMPLOS E VALIDAÇÃO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
        
          
          <label class="md-nav__link" for="__nav_4_10" id="__nav_4_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    3.10 Architecture Decision Records (ADRs)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    3.10 Architecture Decision Records (ADRs)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_12_00_indice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [51] ÍNDICE DE ADRs - VoiceCap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_12_AUTO_VALIDACAO/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [52] AUTO-VALIDAÇÃO: ADRs VoiceCap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_12_01_adrs_arquitetura/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [53] ADRs DE ARQUITETURA - VoiceCap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_12_02_adrs_dados_backend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [54] ADRs DE DADOS & BACKEND - VoiceCap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_12_03_adrs_seguranca_testes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [55] ADRs DE SEGURANÇA & TESTES - VoiceCap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_11" >
        
          
          <label class="md-nav__link" for="__nav_4_11" id="__nav_4_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    3.11 Validação Arquitetural
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    3.11 Validação Arquitetural
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_13_00_INDICE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [56] VALIDAÇÃO FINAL DA ARQUITETURA VOICECAP - ÍNDICE MASTER
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_13_01_validacoes_scores/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [57] VALIDAÇÃO FINAL DA ARQUITETURA - PARTE 1: VALIDAÇÕES E SCORES
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_13_02_riscos_gaps_recomendacoes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [58] VALIDAÇÃO FINAL DA ARQUITETURA - PARTE 2: RISCOS, GAPS E RECOMENDAÇÕES
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_3_13_03_readme_aprovacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [59] VALIDAÇÃO FINAL DA ARQUITETURA - PARTE 3: README E APROVAÇÃO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4. Design de Interface e Interação
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    4. Design de Interface e Interação
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4.1 Sistema de Design (Design Tokens)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    4.1 Sistema de Design (Design Tokens)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_01_00_INDICE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [60] DESIGN TOKENS - VoiceCap (Índice Master)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_01_01_design_tokens_cores_tipografia/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [61] DESIGN TOKENS - VoiceCap (Parte 1/3: Cores e Tipografia)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_01_02_design_tokens_espacamento_visual/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [62] DESIGN TOKENS - VoiceCap (Parte 2/3: Espaçamento e Visual)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_01_03_design_tokens_responsive_animacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [63] DESIGN TOKENS - VoiceCap (Parte 3/3: Responsivo, Animação e Exportação)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4.2 Componentes Atômicos
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    4.2 Componentes Atômicos
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_02_01_atomos_componentes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [64] ÁTOMOS - COMPONENTES BÁSICOS - VoiceCap (Parte 1/2: Especificações)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_02_02_atomos_referencia_validacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [65] ÁTOMOS - COMPONENTES BÁSICOS - VoiceCap (Parte 2/2: Referência e Validação)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4.3 Componentes Moleculares
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    4.3 Componentes Moleculares
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_03_01_moleculas_componentes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [66] MOLÉCULAS - COMPONENTES COMBINADOS - VoiceCap (Parte 1/2: Especificações)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_03_02_moleculas_referencia_validacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [67] MOLÉCULAS - COMPONENTES COMBINADOS - VoiceCap (Parte 2/2: Referência e Validação)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4.4 Componentes Organismos
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    4.4 Componentes Organismos
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_04_01_organismos_datatable/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [68] ORGANISMOS - DATATABLE - VoiceCap (Parte 1/4)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_04_02_organismos_modal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [69] ORGANISMOS - MODAL - VoiceCap (Parte 2/4)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_04_03_organismos_navegacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [70] ORGANISMOS - NAVEGAÇÃO (HEADER + SIDEBAR) - VoiceCap (Parte 3/4)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_04_04_organismos_mapview_validacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [71] ORGANISMOS - MAPVIEW + VALIDAÇÃO - VoiceCap (Parte 4/4)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4.5 Templates de Páginas
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    4.5 Templates de Páginas
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_05_01_template_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [72] TEMPLATE: DASHBOARDTEMPLATE (Parte 1/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_05_02_template_form/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [73] TEMPLATE: FORMTEMPLATE (Parte 2/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_05_03_template_auth_validacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [74] TEMPLATE: AUTHTEMPLATE + VALIDAÇÃO (Parte 3/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4.6 Telas Desktop Completas
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    4.6 Telas Desktop Completas
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_06_01_telas_dashboard_listagem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [75] CONVERSA 06: TELAS DESKTOP - WIREFRAMES DE ALTA FIDELIDADE (PARTE 1/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_06_02_telas_forms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [76] CONVERSA 06: TELAS DESKTOP - WIREFRAMES DE ALTA FIDELIDADE (PARTE 2/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_06_03_telas_detalhes_validacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [77] CONVERSA 06: TELAS DESKTOP - WIREFRAMES DE ALTA FIDELIDADE (PARTE 3/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4.7 Telas Mobile
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    4.7 Telas Mobile
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_07_01_telas_mobile_adaptacoes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [78] CONVERSA 07: TELAS MOBILE - ADAPTAÇÕES DESKTOP (PARTE 1/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_07_02_telas_mobile_exclusivas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [79] CONVERSA 07: TELAS MOBILE - EXCLUSIVAS OPERACIONAIS (PARTE 2/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_07_03_rastreabilidade_cobertura/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [80] CONVERSA 07: TELAS MOBILE - RASTREABILIDADE E COBERTURA (PARTE 3/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4.8 Fluxos de Usuário
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    4.8 Fluxos de Usuário
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_08_01_fluxos_gerencial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [81] CONVERSA 08: FLUXOS DE USUÁRIO - PERFIL GERENCIAL (PARTE 1/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_08_02_fluxos_operacional/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [82] CONVERSA 08: FLUXOS DE USUÁRIO - PERFIL OPERACIONAL (PARTE 2/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_08_03_rastreabilidade_validacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [83] CONVERSA 08: FLUXOS DE USUÁRIO - RASTREABILIDADE E VALIDAÇÃO (PARTE 3/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_9" >
        
          
          <label class="md-nav__link" for="__nav_5_9" id="__nav_5_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4.9 Responsividade Multi-Dispositivo
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    4.9 Responsividade Multi-Dispositivo
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_09_01_responsividade_telas_parte1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [84] CONVERSA 09: RESPONSIVIDADE - ESTRATÉGIA DE ADAPTAÇÃO (PARTE 1/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_09_02_responsividade_telas_parte2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [85] CONVERSA 09: RESPONSIVIDADE - ESTRATÉGIA DE ADAPTAÇÃO (PARTE 2/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_09_03_responsividade_componentes_validacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [86] CONVERSA 09: RESPONSIVIDADE - ESTRATÉGIA DE ADAPTAÇÃO (PARTE 3/3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10" >
        
          
          <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    4.10 Acessibilidade WCAG e Validação
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    4.10 Acessibilidade WCAG e Validação
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_10_01_checklist_componentes_atomos_moleculas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [87] CONVERSA 10: ACESSIBILIDADE WCAG 2.1 AA - PARTE 1/4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_10_02_checklist_componentes_organismos_templates_telas_desktop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [88] CONVERSA 10: ACESSIBILIDADE WCAG 2.1 AA - PARTE 2/4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_10_03_checklist_telas_mobile_validacao_wcag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [89] CONVERSA 10: ACESSIBILIDADE WCAG 2.1 AA - PARTE 3/4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DONE_4_10_04_ferramentas_guia_casos_uso_rnfs_validacao/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    [90] CONVERSA 10: ACESSIBILIDADE WCAG 2.1 AA - PARTE 4/4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../print_page/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Imprimir Documentação Completa
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="Nesta página">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Nesta página
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#metadados" class="md-nav__link">
    <span class="md-ellipsis">
      
        METADADOS
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-diagrama-c4-component-mermaid" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. DIAGRAMA C4 COMPONENT (MERMAID)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-padrao-arquitetural-aplicado" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. PADRÃO ARQUITETURAL APLICADO
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. PADRÃO ARQUITETURAL APLICADO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#padrao-escolhido-hexagonal-architecture-ports-adapters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Padrão Escolhido: Hexagonal Architecture (Ports &amp; Adapters)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camadas-da-hexagonal-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Camadas da Hexagonal Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Camadas da Hexagonal Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#camada-1-domain-core-nucleo-regras-de-negocio-puras" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 1: DOMAIN CORE (Núcleo - Regras de Negócio Puras)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camada-2-application-layer-orquestracao-application-ports" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 2: APPLICATION LAYER (Orquestração + Application Ports)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camada-3-infrastructure-layer-implementacoes-tecnicas-adapters" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 3: INFRASTRUCTURE LAYER (Implementações Técnicas - Adapters)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camada-4-presentation-layer-interface-http-frameworks" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 4: PRESENTATION LAYER (Interface HTTP - Frameworks)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regras-de-dependencia-dependency-rule" class="md-nav__link">
    <span class="md-ellipsis">
      
        Regras de Dependência (Dependency Rule)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-componentes-por-camada" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. COMPONENTES POR CAMADA
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. COMPONENTES POR CAMADA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#camada-1-domain-core" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 1: DOMAIN CORE
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CAMADA 1: DOMAIN CORE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entities-entidades-com-identidade-e-regras-de-negocio" class="md-nav__link">
    <span class="md-ellipsis">
      
        Entities (Entidades com Identidade e Regras de Negócio)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#value-objects-objetos-imutaveis-sem-identidade" class="md-nav__link">
    <span class="md-ellipsis">
      
        Value Objects (Objetos Imutáveis sem Identidade)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repository-interfaces-domain-ports-contratos-de-persistencia" class="md-nav__link">
    <span class="md-ellipsis">
      
        Repository Interfaces (Domain Ports - Contratos de Persistência)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-services-logica-de-negocio-complexa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Domain Services (Lógica de Negócio Complexa)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camada-2-application-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 2: APPLICATION LAYER
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CAMADA 2: APPLICATION LAYER">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-cases-1-por-funcionalidade-principal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use Cases (1 por funcionalidade principal)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-ports-interfaces-para-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Application Ports (Interfaces para Infrastructure)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dtos-data-transfer-objects" class="md-nav__link">
    <span class="md-ellipsis">
      
        DTOs (Data Transfer Objects)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camada-3-infrastructure-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 3: INFRASTRUCTURE LAYER
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CAMADA 3: INFRASTRUCTURE LAYER">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ia-adapters-implementam-application-ports" class="md-nav__link">
    <span class="md-ellipsis">
      
        IA Adapters (Implementam Application Ports)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-adapters-implementam-application-ports" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Adapters (Implementam Application Ports)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repository-implementations-implementam-domain-ports" class="md-nav__link">
    <span class="md-ellipsis">
      
        Repository Implementations (Implementam Domain Ports)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-adapters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration Adapters
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camada-4-presentation-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        CAMADA 4: PRESENTATION LAYER
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CAMADA 4: PRESENTATION LAYER">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#controllers-endpoints-rest-fastify-routers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Controllers (Endpoints REST - Fastify Routers)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#middlewares" class="md-nav__link">
    <span class="md-ellipsis">
      
        Middlewares
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schemas-validacao-requestresponse-zod" class="md-nav__link">
    <span class="md-ellipsis">
      
        Schemas (Validação Request/Response - Zod)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-matriz-de-dependencias" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. MATRIZ DE DEPENDÊNCIAS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. MATRIZ DE DEPENDÊNCIAS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#regra-da-hexagonal-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Regra da Hexagonal Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explicacao-detalhada" class="md-nav__link">
    <span class="md-ellipsis">
      
        Explicação Detalhada
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exemplos-de-codigo" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exemplos de Código
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exemplos de Código">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#correto-application-importa-domain" class="md-nav__link">
    <span class="md-ellipsis">
      
        ✅ CORRETO: Application importa Domain
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correto-infrastructure-implementa-application-port" class="md-nav__link">
    <span class="md-ellipsis">
      
        ✅ CORRETO: Infrastructure implementa Application Port
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correto-presentation-injeta-dependencias-via-di-container" class="md-nav__link">
    <span class="md-ellipsis">
      
        ✅ CORRETO: Presentation injeta dependências via DI Container
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errado-domain-importa-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ ERRADO: Domain importa Infrastructure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errado-application-importa-infrastructure-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ ERRADO: Application importa Infrastructure Adapter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#errado-presentation-importa-adapter-concreto" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ ERRADO: Presentation importa Adapter concreto
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validacao-da-matriz" class="md-nav__link">
    <span class="md-ellipsis">
      
        Validação da Matriz
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="diagrama-c4-nivel-3-component-backend-voicecap">DIAGRAMA C4 NÍVEL 3 (COMPONENT - BACKEND) - VoiceCap<a class="headerlink" href="#diagrama-c4-nivel-3-component-backend-voicecap" title="Permanent link">&para;</a></h1>
<h2 id="metadados">METADADOS<a class="headerlink" href="#metadados" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Camada:</strong> 3 - Arquitetura</li>
<li><strong>Conversa:</strong> 04</li>
<li><strong>Padrão Arquitetural:</strong> Hexagonal Architecture (Ports &amp; Adapters)</li>
<li><strong>Container Detalhado:</strong> Backend API (Node.js 20 + TypeScript 5.3)</li>
<li><strong>Data de Criação:</strong> 2026-02-01</li>
</ul>
<hr />
<h2 id="1-diagrama-c4-component-mermaid">1. DIAGRAMA C4 COMPONENT (MERMAID)<a class="headerlink" href="#1-diagrama-c4-component-mermaid" title="Permanent link">&para;</a></h2>
<pre class="mermaid"><code>C4Component
    title Component Diagram - Backend API (Hexagonal Architecture)

    Container_Boundary(api, "Backend API - Node.js 20 + TypeScript 5.3") {
        %% PRESENTATION LAYER (HTTP Interface)
        Component(audio_ctrl, "AudioController", "Fastify Router", "POST /audio/upload, POST /audio/process")
        Component(transcription_ctrl, "TranscriptionController", "Fastify Router", "POST /transcription/refine, GET /transcription/:id")
        Component(inspection_ctrl, "InspectionController", "Fastify Router", "GET /inspections, POST /inspections, PATCH /inspections/:id")
        Component(form_ctrl, "FormController", "Fastify Router", "GET /forms, POST /forms/sync")
        Component(auth_ctrl, "AuthController", "Fastify Router", "POST /auth/login, POST /auth/refresh")
        Component(integration_ctrl, "IntegrationController", "Fastify Router", "POST /integration/kaffa/callback")

        Component(auth_middleware, "AuthMiddleware", "JWT Validation", "Valida token JWT em todas rotas protegidas")
        Component(tenant_middleware, "TenantMiddleware", "RLS Context", "Injeta company_id no contexto RLS Supabase")
        Component(rate_limit_middleware, "RateLimitMiddleware", "Rate Limiter", "100 req/min por IP, Redis-backed")

        %% APPLICATION LAYER (Use Cases + Ports)
        Component(process_audio_local_uc, "ProcessAudioLocalUseCase", "Application", "Processa áudio local (device), armazena transcrição")
        Component(refine_audio_cloud_uc, "RefineAudioCloudUseCase", "Application", "Refina transcrição local com IA cloud")
        Component(sync_form_uc, "SyncFormUseCase", "Application", "Sincroniza formulário preenchido device→cloud")
        Component(validate_form_uc, "ValidateFormUseCase", "Application", "Valida completude campos + regras negócio")
        Component(generate_pdf_uc, "GeneratePDFUseCase", "Application", "Gera PDF inspeção com evidências")
        Component(authenticate_user_uc, "AuthenticateUserUseCase", "Application", "Valida credenciais multi-tenant")

        Component(transcription_port, "ITranscriptionPort", "Application Port (Interface)", "transcribe(audio): Transcription")
        Component(llm_port, "ILLMPort", "Application Port (Interface)", "complete(prompt, context): Completion")
        Component(rag_port, "IRAGPort", "Application Port (Interface)", "search(query, company_id): Document[]")
        Component(storage_port, "IStoragePort", "Application Port (Interface)", "upload(file): URL, download(url): File")
        Component(auth_port, "IAuthPort", "Application Port (Interface)", "validateJWT(token): User, generateJWT(user): Token")

        %% DOMAIN LAYER (Entities + Repository Interfaces)
        Component(inspection_entity, "Inspection", "Domain Entity (Aggregate Root)", "id, company_id, inspector_id, status, created_at")
        Component(audio_entity, "Audio", "Domain Entity", "id, inspection_id, file_url, duration, status")
        Component(transcription_entity, "Transcription", "Domain Entity", "id, audio_id, text, confidence, source")
        Component(form_entity, "Form", "Domain Entity", "id, company_id, template_id, fields, status")
        Component(company_entity, "Company", "Domain Entity", "id, name, rag_config, active")
        Component(user_entity, "User", "Domain Entity", "id, email, company_id, role, active")

        Component(company_id_vo, "CompanyId", "Domain Value Object", "UUID imutável")
        Component(inspector_id_vo, "InspectorId", "Domain Value Object", "UUID imutável")
        Component(audio_duration_vo, "AudioDuration", "Domain Value Object", "seconds (&gt;0, ≤1800)")
        Component(transcription_status_vo, "TranscriptionStatus", "Domain Value Object", "Enum: PENDING, LOCAL, CLOUD, REFINED")

        Component(inspection_repo_iface, "IInspectionRepository", "Domain Port (Interface)", "save(), findById(), findByCompany()")
        Component(audio_repo_iface, "IAudioRepository", "Domain Port (Interface)", "save(), findByInspection()")
        Component(form_repo_iface, "IFormRepository", "Domain Port (Interface)", "save(), findByCompany(), findByTemplate()")
        Component(user_repo_iface, "IUserRepository", "Domain Port (Interface)", "findByEmail(), findById()")

        %% INFRASTRUCTURE LAYER (Adapters - IA Providers)
        Component(groq_whisper_adapter, "GroqWhisperAdapter", "Infrastructure Adapter", "Implementa ITranscriptionPort via Groq Whisper Large V3")
        Component(openai_whisper_adapter, "OpenAIWhisperAdapter", "Infrastructure Adapter", "Implementa ITranscriptionPort via OpenAI Whisper")
        Component(azure_whisper_adapter, "AzureWhisperAdapter", "Infrastructure Adapter", "Implementa ITranscriptionPort via Azure Whisper")

        Component(groq_llama_adapter, "GroqLlamaAdapter", "Infrastructure Adapter", "Implementa ILLMPort via Groq LLaMA 3.3 70B")
        Component(gpt4_adapter, "GPT4Adapter", "Infrastructure Adapter", "Implementa ILLMPort via OpenAI GPT-4 Turbo")
        Component(claude_adapter, "ClaudeAdapter", "Infrastructure Adapter", "Implementa ILLMPort via Anthropic Claude 3.5")

        Component(supabase_vector_adapter, "SupabaseVectorAdapter", "Infrastructure Adapter", "Implementa IRAGPort via pgvector 0.5")
        Component(supabase_storage_adapter, "SupabaseStorageAdapter", "Infrastructure Adapter", "Implementa IStoragePort via Supabase Storage S3")
        Component(supabase_auth_adapter, "SupabaseAuthAdapter", "Infrastructure Adapter", "Implementa IAuthPort via Supabase Auth JWT")

        %% INFRASTRUCTURE LAYER (Adapters - Repositories)
        Component(supabase_inspection_repo, "SupabaseInspectionRepository", "Infrastructure Adapter", "Implementa IInspectionRepository via PostgreSQL 15")
        Component(supabase_audio_repo, "SupabaseAudioRepository", "Infrastructure Adapter", "Implementa IAudioRepository via PostgreSQL 15")
        Component(supabase_form_repo, "SupabaseFormRepository", "Infrastructure Adapter", "Implementa IFormRepository via PostgreSQL 15")
        Component(supabase_user_repo, "SupabaseUserRepository", "Infrastructure Adapter", "Implementa IUserRepository via PostgreSQL 15")

        %% INFRASTRUCTURE LAYER (Adapters - Integration)
        Component(kaffa_adapter, "KaffaAdapter", "Infrastructure Adapter", "Callbacks Android Intent para Kaffa SDK")
        Component(redis_cache_adapter, "RedisCacheAdapter", "Infrastructure Adapter", "Cache queries RAG (5min TTL) via Upstash Redis 7.2")
    }

    %% EXTERNAL SYSTEMS
    ContainerDb(supabase_db, "Supabase PostgreSQL", "PostgreSQL 15 + pgvector 0.5")
    ContainerDb(redis, "Upstash Redis", "Redis 7.2 Serverless")
    System_Ext(groq_api, "Groq API", "Whisper + LLaMA 3.3 70B")
    System_Ext(openai_api, "OpenAI API", "Whisper + GPT-4 Turbo")
    System_Ext(azure_api, "Azure OpenAI", "Whisper + GPT-4")
    System_Ext(supabase_storage, "Supabase Storage", "S3 Compatible")
    System_Ext(kaffa_system, "Kaffa", "Sistema Android legado")

    %% RELATIONSHIPS - Presentation → Application
    Rel(audio_ctrl, process_audio_local_uc, "Chama", "TypeScript")
    Rel(transcription_ctrl, refine_audio_cloud_uc, "Chama", "TypeScript")
    Rel(inspection_ctrl, validate_form_uc, "Chama", "TypeScript")
    Rel(form_ctrl, sync_form_uc, "Chama", "TypeScript")
    Rel(auth_ctrl, authenticate_user_uc, "Chama", "TypeScript")
    Rel(integration_ctrl, process_audio_local_uc, "Chama (Kaffa)", "TypeScript")

    Rel(auth_middleware, auth_port, "Valida JWT via", "TypeScript")
    Rel(tenant_middleware, company_id_vo, "Extrai e valida", "TypeScript")

    %% RELATIONSHIPS - Application → Domain (Entities)
    Rel(process_audio_local_uc, audio_entity, "Cria/Valida", "TypeScript")
    Rel(process_audio_local_uc, transcription_entity, "Cria", "TypeScript")
    Rel(refine_audio_cloud_uc, transcription_entity, "Atualiza", "TypeScript")
    Rel(sync_form_uc, form_entity, "Cria/Atualiza", "TypeScript")
    Rel(validate_form_uc, form_entity, "Valida regras", "TypeScript")
    Rel(authenticate_user_uc, user_entity, "Valida", "TypeScript")

    %% RELATIONSHIPS - Application → Domain (Repository Interfaces)
    Rel(process_audio_local_uc, audio_repo_iface, "Chama save()", "TypeScript")
    Rel(sync_form_uc, form_repo_iface, "Chama save()", "TypeScript")
    Rel(validate_form_uc, inspection_repo_iface, "Chama findById()", "TypeScript")
    Rel(authenticate_user_uc, user_repo_iface, "Chama findByEmail()", "TypeScript")

    %% RELATIONSHIPS - Application → Application Ports
    Rel(process_audio_local_uc, storage_port, "Upload áudio via", "TypeScript")
    Rel(refine_audio_cloud_uc, transcription_port, "Transcreve via", "TypeScript")
    Rel(refine_audio_cloud_uc, llm_port, "Preenche campos via", "TypeScript")
    Rel(refine_audio_cloud_uc, rag_port, "Busca contexto via", "TypeScript")
    Rel(authenticate_user_uc, auth_port, "Gera JWT via", "TypeScript")

    %% RELATIONSHIPS - Infrastructure Adapters → Application Ports (Implementa)
    Rel(groq_whisper_adapter, transcription_port, "Implementa", "TypeScript")
    Rel(openai_whisper_adapter, transcription_port, "Implementa", "TypeScript")
    Rel(azure_whisper_adapter, transcription_port, "Implementa", "TypeScript")
    Rel(groq_llama_adapter, llm_port, "Implementa", "TypeScript")
    Rel(gpt4_adapter, llm_port, "Implementa", "TypeScript")
    Rel(claude_adapter, llm_port, "Implementa", "TypeScript")
    Rel(supabase_vector_adapter, rag_port, "Implementa", "TypeScript")
    Rel(supabase_storage_adapter, storage_port, "Implementa", "TypeScript")
    Rel(supabase_auth_adapter, auth_port, "Implementa", "TypeScript")

    %% RELATIONSHIPS - Infrastructure Adapters → Domain Ports (Implementa)
    Rel(supabase_inspection_repo, inspection_repo_iface, "Implementa", "TypeScript")
    Rel(supabase_audio_repo, audio_repo_iface, "Implementa", "TypeScript")
    Rel(supabase_form_repo, form_repo_iface, "Implementa", "TypeScript")
    Rel(supabase_user_repo, user_repo_iface, "Implementa", "TypeScript")

    %% RELATIONSHIPS - Infrastructure Adapters → External Systems
    Rel(groq_whisper_adapter, groq_api, "REST API", "HTTPS")
    Rel(groq_llama_adapter, groq_api, "REST API", "HTTPS")
    Rel(openai_whisper_adapter, openai_api, "REST API", "HTTPS")
    Rel(gpt4_adapter, openai_api, "REST API", "HTTPS")
    Rel(azure_whisper_adapter, azure_api, "REST API", "HTTPS")
    Rel(supabase_vector_adapter, supabase_db, "pgvector queries", "PostgreSQL wire")
    Rel(supabase_storage_adapter, supabase_storage, "S3 API", "HTTPS")
    Rel(supabase_auth_adapter, supabase_db, "JWT validation", "PostgreSQL wire")
    Rel(supabase_inspection_repo, supabase_db, "SQL CRUD", "PostgreSQL wire")
    Rel(supabase_audio_repo, supabase_db, "SQL CRUD", "PostgreSQL wire")
    Rel(supabase_form_repo, supabase_db, "SQL CRUD", "PostgreSQL wire")
    Rel(supabase_user_repo, supabase_db, "SQL CRUD", "PostgreSQL wire")
    Rel(redis_cache_adapter, redis, "Cache ops", "RESP protocol")
    Rel(kaffa_adapter, kaffa_system, "Android callbacks", "Android Intent")</code></pre>
<hr />
<h2 id="2-padrao-arquitetural-aplicado">2. PADRÃO ARQUITETURAL APLICADO<a class="headerlink" href="#2-padrao-arquitetural-aplicado" title="Permanent link">&para;</a></h2>
<h3 id="padrao-escolhido-hexagonal-architecture-ports-adapters">Padrão Escolhido: Hexagonal Architecture (Ports &amp; Adapters)<a class="headerlink" href="#padrao-escolhido-hexagonal-architecture-ports-adapters" title="Permanent link">&para;</a></h3>
<p><strong>Referência:</strong> <code>DONE_3_01_07_alternativas_adr.md</code> - ADR-000 (Score 8.8/10)</p>
<p><strong>Justificativa da escolha:</strong>
- Portabilidade máxima para testes frequentes de providers IA (7+ mudanças MVP)
- Swap de providers em 2h (vs 3-6h Clean Architecture)
- A/B Testing trivial via Composite Ports (testar 2-3 providers paralelo)
- IA gera código: overhead Ports negligível (0.5 dia vs 0.3 dia Clean)</p>
<hr />
<h3 id="camadas-da-hexagonal-architecture">Camadas da Hexagonal Architecture<a class="headerlink" href="#camadas-da-hexagonal-architecture" title="Permanent link">&para;</a></h3>
<h4 id="camada-1-domain-core-nucleo-regras-de-negocio-puras">CAMADA 1: DOMAIN CORE (Núcleo - Regras de Negócio Puras)<a class="headerlink" href="#camada-1-domain-core-nucleo-regras-de-negocio-puras" title="Permanent link">&para;</a></h4>
<p><strong>Responsabilidade:</strong> Regras de negócio puras, lógica de domínio, ZERO dependências externas (frameworks, bibliotecas, APIs)</p>
<p><strong>Dependências:</strong> NENHUMA (zero imports de outras camadas ou bibliotecas externas)</p>
<p><strong>Componentes:</strong>
- <strong>Entities:</strong> Objetos com identidade e ciclo de vida (Inspection, Audio, Transcription, Form, Company, User)
- <strong>Value Objects:</strong> Objetos imutáveis sem identidade (CompanyId, InspectorId, AudioDuration, TranscriptionStatus)
- <strong>Repository Interfaces (Domain Ports):</strong> Contratos abstratos para persistência (IInspectionRepository, IAudioRepository, IFormRepository, IUserRepository)
- <strong>Domain Services:</strong> Lógica de negócio complexa que não cabe em uma Entity (se houver)
- <strong>Domain Exceptions:</strong> Exceções específicas do domínio (InspectionAlreadyApproved, InvalidAudioDuration)</p>
<p><strong>Princípio fundamental:</strong> Domain Core não conhece PostgreSQL, Fastify, Supabase, Groq, ou qualquer tecnologia externa. É 100% testável isoladamente.</p>
<hr />
<h4 id="camada-2-application-layer-orquestracao-application-ports">CAMADA 2: APPLICATION LAYER (Orquestração + Application Ports)<a class="headerlink" href="#camada-2-application-layer-orquestracao-application-ports" title="Permanent link">&para;</a></h4>
<p><strong>Responsabilidade:</strong> Orquestrar use cases, coordenar Domain Core e Infrastructure via Ports (interfaces abstratas)</p>
<p><strong>Dependências:</strong> Apenas Domain Core (entities, value objects, repository interfaces)</p>
<p><strong>Componentes:</strong></p>
<p><strong>A) Use Cases (Orquestração de casos de uso):</strong>
- ProcessAudioLocalUseCase
- RefineAudioCloudUseCase
- SyncFormUseCase
- ValidateFormUseCase
- GeneratePDFUseCase
- AuthenticateUserUseCase</p>
<p><strong>B) Application Ports (Interfaces para Infrastructure):</strong>
- ITranscriptionPort - Contrato para serviços de transcrição
- ILLMPort - Contrato para serviços de LLM (preenchimento campos)
- IRAGPort - Contrato para busca vetorial (base conhecimento)
- IStoragePort - Contrato para armazenamento de arquivos
- IAuthPort - Contrato para autenticação/autorização</p>
<p><strong>C) DTOs (Data Transfer Objects - Input/Output):</strong>
- ProcessAudioInputDTO, ProcessAudioOutputDTO
- RefineTranscriptionInputDTO, RefineTranscriptionOutputDTO
- SyncFormInputDTO, SyncFormOutputDTO
- AuthenticateInputDTO, AuthenticateOutputDTO</p>
<p><strong>Princípio fundamental:</strong> Application Layer não conhece implementações concretas (não sabe se é Groq ou OpenAI, PostgreSQL ou MongoDB). Depende apenas de contratos abstratos (Ports).</p>
<hr />
<h4 id="camada-3-infrastructure-layer-implementacoes-tecnicas-adapters">CAMADA 3: INFRASTRUCTURE LAYER (Implementações Técnicas - Adapters)<a class="headerlink" href="#camada-3-infrastructure-layer-implementacoes-tecnicas-adapters" title="Permanent link">&para;</a></h4>
<p><strong>Responsabilidade:</strong> Implementações concretas dos Ports (Application + Domain), integrações com tecnologias externas</p>
<p><strong>Dependências:</strong> Domain Core + Application Layer (implementa interfaces dos Ports)</p>
<p><strong>Componentes:</strong></p>
<p><strong>A) IA Adapters (Implementam Application Ports):</strong>
- GroqWhisperAdapter (implementa ITranscriptionPort)
- OpenAIWhisperAdapter (implementa ITranscriptionPort)
- AzureWhisperAdapter (implementa ITranscriptionPort)
- GroqLlamaAdapter (implementa ILLMPort)
- GPT4Adapter (implementa ILLMPort)
- ClaudeAdapter (implementa ILLMPort)</p>
<p><strong>B) Data Adapters (Implementam Application Ports):</strong>
- SupabaseVectorAdapter (implementa IRAGPort)
- SupabaseStorageAdapter (implementa IStoragePort)
- SupabaseAuthAdapter (implementa IAuthPort)
- RedisCacheAdapter (cache intermediário)</p>
<p><strong>C) Repository Implementations (Implementam Domain Ports):</strong>
- SupabaseInspectionRepository (implementa IInspectionRepository)
- SupabaseAudioRepository (implementa IAudioRepository)
- SupabaseFormRepository (implementa IFormRepository)
- SupabaseUserRepository (implementa IUserRepository)</p>
<p><strong>D) Integration Adapters:</strong>
- KaffaAdapter (callbacks para integração com Kaffa Android)</p>
<p><strong>E) Database Models (ORM - se houver):</strong>
- InspectionModel, AudioModel (mapeamento PostgreSQL tables)</p>
<p><strong>F) Mappers (Entity ↔ Model):</strong>
- InspectionMapper, AudioMapper (conversão Domain Entity ↔ Database Model)</p>
<p><strong>Princípio fundamental:</strong> Adapters conhecem tecnologias concretas (Groq API, Supabase PostgreSQL, Redis), mas implementam interfaces abstratas. Trocar Groq → OpenAI = criar novo Adapter, NÃO tocar Domain ou Application.</p>
<hr />
<h4 id="camada-4-presentation-layer-interface-http-frameworks">CAMADA 4: PRESENTATION LAYER (Interface HTTP - Frameworks)<a class="headerlink" href="#camada-4-presentation-layer-interface-http-frameworks" title="Permanent link">&para;</a></h4>
<p><strong>Responsabilidade:</strong> Interface HTTP (REST API), validação de entrada, serialização de resposta, middlewares</p>
<p><strong>Dependências:</strong> Application Layer (Use Cases) + Infrastructure Layer via Dependency Injection</p>
<p><strong>Componentes:</strong></p>
<p><strong>A) Controllers (Endpoints REST - Fastify Routers):</strong>
- AudioController
- TranscriptionController
- InspectionController
- FormController
- AuthController
- IntegrationController</p>
<p><strong>B) Middlewares:</strong>
- AuthMiddleware (JWT validation via IAuthPort)
- TenantMiddleware (RLS context injection)
- RateLimitMiddleware (100 req/min via Redis)</p>
<p><strong>C) Schemas (Validação - Zod):</strong>
- ProcessAudioRequestSchema
- RefineTranscriptionRequestSchema
- SyncFormRequestSchema
- AuthenticateRequestSchema
- InspectionResponseSchema</p>
<p><strong>D) Dependency Injection Container:</strong>
- Configura bindings: ITranscriptionPort → GroqWhisperAdapter (ou OpenAIWhisperAdapter via environment variable)</p>
<p><strong>Princípio fundamental:</strong> Controllers orquestram Use Cases (não contêm lógica de negócio). Frameworks (Fastify, Zod) ficam isolados nesta camada.</p>
<hr />
<h3 id="regras-de-dependencia-dependency-rule">Regras de Dependência (Dependency Rule)<a class="headerlink" href="#regras-de-dependencia-dependency-rule" title="Permanent link">&para;</a></h3>
<p><strong>Princípio fundamental da Hexagonal Architecture:</strong></p>
<blockquote>
<p><strong>Dependências apontam PARA DENTRO (de camadas externas para camadas internas). Domain Core não depende de NADA.</strong></p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Frameworks (Presentation)
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    ↓ depende de
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>Application (Use Cases + Ports)
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    ↓ depende de
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>Domain Core (Entities + Repository Interfaces)
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    ↑ implementado por
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>Infrastructure (Adapters)
</code></pre></div>
<p><strong>Regra detalhada:</strong></p>
<ol>
<li><strong>Domain Core</strong> → Não depende de NADA (zero imports externos)</li>
<li><strong>Application</strong> → Depende apenas de Domain Core</li>
<li><strong>Infrastructure</strong> → Depende de Domain Core + Application (implementa Ports)</li>
<li><strong>Presentation</strong> → Depende de Application + Infrastructure via DI</li>
</ol>
<hr />
<h2 id="3-componentes-por-camada">3. COMPONENTES POR CAMADA<a class="headerlink" href="#3-componentes-por-camada" title="Permanent link">&para;</a></h2>
<h3 id="camada-1-domain-core">CAMADA 1: DOMAIN CORE<a class="headerlink" href="#camada-1-domain-core" title="Permanent link">&para;</a></h3>
<h4 id="entities-entidades-com-identidade-e-regras-de-negocio">Entities (Entidades com Identidade e Regras de Negócio)<a class="headerlink" href="#entities-entidades-com-identidade-e-regras-de-negocio" title="Permanent link">&para;</a></h4>
<p><strong>1. Inspection (Aggregate Root)</strong>
- <strong>Atributos:</strong>
  - id: UUID (Primary Key)
  - company_id: UUID (Foreign Key - multi-tenant)
  - inspector_id: UUID (Foreign Key - usuário técnico)
  - form_template_id: UUID (Foreign Key - template formulário)
  - status: Enum (DRAFT, PENDING, APPROVED, COMPLETED, REJECTED)
  - created_at: DateTime
  - updated_at: DateTime
  - approved_at: DateTime (nullable)
  - approved_by_id: UUID (nullable)</p>
<ul>
<li><strong>Métodos de negócio:</strong></li>
<li><code>create()</code> - Valida company_id e inspector_id obrigatórios</li>
<li><code>addAudio(audio: Audio)</code> - Adiciona áudio, valida máximo 5 áudios por inspeção</li>
<li><code>approve(supervisor_id: UUID)</code> - Valida status PENDING, transição para APPROVED</li>
<li><code>reject(supervisor_id: UUID, reason: string)</code> - Transição para REJECTED</li>
<li><code>complete()</code> - Valida status APPROVED + formulário 100% preenchido</li>
<li>
<p><code>canBeEdited(): boolean</code> - Retorna false se status = APPROVED/COMPLETED</p>
</li>
<li>
<p><strong>Regras de negócio:</strong></p>
</li>
<li>Status inicial sempre DRAFT</li>
<li>Máximo 5 áudios por inspeção</li>
<li>Apenas inspetores da mesma company_id podem editar</li>
<li>Inspeções APPROVED não podem ser editadas (imutáveis)</li>
</ul>
<hr />
<p><strong>2. Audio</strong>
- <strong>Atributos:</strong>
  - id: UUID
  - inspection_id: UUID (FK - pertence a uma Inspection)
  - file_url: String (S3 URL após upload)
  - file_size_bytes: Integer
  - duration_seconds: Integer (1-1800, máximo 30 minutos)
  - format: Enum (OPUS, AAC, WAV)
  - status: Enum (UPLOADED, PROCESSING, TRANSCRIBED, ERROR)
  - created_at: DateTime</p>
<ul>
<li><strong>Métodos de negócio:</strong></li>
<li><code>validateDuration()</code> - Valida 1 ≤ duration ≤ 1800 segundos</li>
<li><code>validateSize()</code> - Valida file_size ≤ 50MB</li>
<li><code>markAsTranscribed()</code> - Transição status PROCESSING → TRANSCRIBED</li>
<li>
<p><code>markAsError(error: string)</code> - Transição para ERROR com mensagem</p>
</li>
<li>
<p><strong>Regras de negócio:</strong></p>
</li>
<li>Duração mínima 1 segundo (não aceita áudios vazios)</li>
<li>Duração máxima 30 minutos (1800s)</li>
<li>Tamanho máximo 50MB</li>
<li>Formatos aceitos: OPUS (preferencial), AAC, WAV</li>
</ul>
<hr />
<p><strong>3. Transcription</strong>
- <strong>Atributos:</strong>
  - id: UUID
  - audio_id: UUID (FK - uma transcrição por áudio)
  - text: String (texto transcrito completo)
  - confidence_score: Float (0.0-1.0, confiança modelo)
  - source: Enum (LOCAL_DEVICE, CLOUD_GROQ, CLOUD_OPENAI, CLOUD_AZURE)
  - language: String (ISO 639-1, ex: "pt-BR")
  - words_count: Integer
  - created_at: DateTime
  - refined_at: DateTime (nullable, quando refinado por cloud)</p>
<ul>
<li><strong>Métodos de negócio:</strong></li>
<li><code>refineWithCloud(new_text: string, new_source: string)</code> - Atualiza text e source, registra refined_at</li>
<li><code>calculateConfidence()</code> - Recalcula confidence_score baseado em palavras incertas</li>
<li>
<p><code>isHighConfidence(): boolean</code> - Retorna true se confidence ≥ 0.85</p>
</li>
<li>
<p><strong>Regras de negócio:</strong></p>
</li>
<li>Confidence mínimo aceitável: 0.70 (abaixo disso sugere re-gravação)</li>
<li>Source LOCAL_DEVICE pode ser refinado por CLOUD</li>
<li>Texto vazio não é permitido (mínimo 10 caracteres)</li>
</ul>
<hr />
<p><strong>4. Form</strong>
- <strong>Atributos:</strong>
  - id: UUID
  - company_id: UUID (FK - formulários por empresa)
  - inspection_id: UUID (FK - formulário pertence a inspeção)
  - template_id: UUID (FK - template dinâmico configurado por admin)
  - fields: JSONB (campos dinâmicos preenchidos: {field_name: value})
  - completeness_percentage: Float (0-100, % campos preenchidos)
  - status: Enum (INCOMPLETE, COMPLETE, VALIDATED)
  - created_at: DateTime
  - updated_at: DateTime</p>
<ul>
<li><strong>Métodos de negócio:</strong></li>
<li><code>updateField(field_name: string, value: any)</code> - Atualiza campo, recalcula completeness</li>
<li><code>calculateCompleteness()</code> - Calcula % campos obrigatórios preenchidos</li>
<li><code>validate()</code> - Valida tipos de dados + regras de negócio específicas do template</li>
<li>
<p><code>isComplete(): boolean</code> - Retorna true se completeness = 100%</p>
</li>
<li>
<p><strong>Regras de negócio:</strong></p>
</li>
<li>Completeness mínimo para aprovação: 90%</li>
<li>Campos obrigatórios definidos no template (configuração por empresa)</li>
<li>JSONB valida tipos: string, number, boolean, date, select (enum)</li>
</ul>
<hr />
<p><strong>5. Company</strong>
- <strong>Atributos:</strong>
  - id: UUID
  - name: String (nome da empresa cliente)
  - cnpj: String (unique - multi-tenant identifier)
  - rag_config: JSONB (configuração base RAG: embeddings, top_k, threshold)
  - active: Boolean
  - created_at: DateTime
  - subscription_tier: Enum (FREE, PRO, ENTERPRISE)</p>
<ul>
<li><strong>Métodos de negócio:</strong></li>
<li><code>activate()</code> - Ativa empresa (active = true)</li>
<li><code>deactivate()</code> - Desativa empresa (active = false)</li>
<li><code>updateRAGConfig(config: object)</code> - Valida e atualiza configuração RAG</li>
<li>
<p><code>canUploadDocuments(): boolean</code> - Verifica limite documentos RAG por tier</p>
</li>
<li>
<p><strong>Regras de negócio:</strong></p>
</li>
<li>CNPJ obrigatório e único</li>
<li>RAG config: top_k padrão 5, threshold padrão 0.75</li>
<li>FREE tier: máximo 50 documentos RAG, PRO: 500, ENTERPRISE: ilimitado</li>
</ul>
<hr />
<p><strong>6. User</strong>
- <strong>Atributos:</strong>
  - id: UUID
  - company_id: UUID (FK - multi-tenant)
  - email: String (unique por company_id)
  - password_hash: String
  - full_name: String
  - role: Enum (ADMIN, SUPERVISOR, INSPECTOR)
  - active: Boolean
  - last_login_at: DateTime (nullable)
  - created_at: DateTime</p>
<ul>
<li><strong>Métodos de negócio:</strong></li>
<li><code>validatePassword(password: string): boolean</code> - Valida senha contra hash</li>
<li><code>hasPermission(permission: string): boolean</code> - Verifica permissão por role</li>
<li><code>activate()</code> - Ativa usuário</li>
<li><code>deactivate()</code> - Desativa usuário</li>
<li>
<p><code>updateLastLogin()</code> - Atualiza last_login_at</p>
</li>
<li>
<p><strong>Regras de negócio:</strong></p>
</li>
<li>Email único dentro de company_id (não global)</li>
<li>Senha mínimo 8 caracteres, bcrypt hash</li>
<li>INSPECTOR: pode criar inspeções</li>
<li>SUPERVISOR: pode aprovar inspeções</li>
<li>ADMIN: pode gerenciar usuários + formulários</li>
</ul>
<hr />
<h4 id="value-objects-objetos-imutaveis-sem-identidade">Value Objects (Objetos Imutáveis sem Identidade)<a class="headerlink" href="#value-objects-objetos-imutaveis-sem-identidade" title="Permanent link">&para;</a></h4>
<p><strong>1. CompanyId</strong>
- <strong>Atributos:</strong> value: UUID
- <strong>Validação:</strong> UUID válido, não vazio
- <strong>Imutabilidade:</strong> Não pode ser alterado após criação
- <strong>Métodos:</strong> <code>equals(other: CompanyId): boolean</code>, <code>toString(): string</code></p>
<p><strong>2. InspectorId</strong>
- <strong>Atributos:</strong> value: UUID
- <strong>Validação:</strong> UUID válido, não vazio
- <strong>Imutabilidade:</strong> Não pode ser alterado após criação</p>
<p><strong>3. AudioDuration</strong>
- <strong>Atributos:</strong> seconds: Integer
- <strong>Validação:</strong> 1 ≤ seconds ≤ 1800
- <strong>Métodos:</strong> <code>toMinutes(): Float</code>, <code>isWithinLimit(): boolean</code></p>
<p><strong>4. TranscriptionStatus</strong>
- <strong>Atributos:</strong> value: Enum (PENDING, LOCAL, CLOUD, REFINED, ERROR)
- <strong>Métodos:</strong> <code>canBeRefined(): boolean</code> (true se LOCAL ou CLOUD)</p>
<hr />
<h4 id="repository-interfaces-domain-ports-contratos-de-persistencia">Repository Interfaces (Domain Ports - Contratos de Persistência)<a class="headerlink" href="#repository-interfaces-domain-ports-contratos-de-persistencia" title="Permanent link">&para;</a></h4>
<p><strong>1. IInspectionRepository</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">IInspectionRepository</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="nx">save</span><span class="p">(</span><span class="nx">inspection</span><span class="o">:</span><span class="w"> </span><span class="kt">Inspection</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Inspection</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Inspection</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="nx">findByCompany</span><span class="p">(</span><span class="nx">company_id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">,</span><span class="w"> </span><span class="nx">filters?</span><span class="o">:</span><span class="w"> </span><span class="kt">object</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Inspection</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="nx">findByInspector</span><span class="p">(</span><span class="nx">inspector_id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">,</span><span class="w"> </span><span class="nx">filters?</span><span class="o">:</span><span class="w"> </span><span class="kt">object</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Inspection</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">  </span><span class="nx">findPendingApproval</span><span class="p">(</span><span class="nx">company_id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Inspection</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span><span class="nx">update</span><span class="p">(</span><span class="nx">inspection</span><span class="o">:</span><span class="w"> </span><span class="kt">Inspection</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Inspection</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="ow">delete</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>2. IAudioRepository</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">IAudioRepository</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="nx">save</span><span class="p">(</span><span class="nx">audio</span><span class="o">:</span><span class="w"> </span><span class="kt">Audio</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Audio</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Audio</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="nx">findByInspection</span><span class="p">(</span><span class="nx">inspection_id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Audio</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="nx">findByStatus</span><span class="p">(</span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Audio</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="nx">update</span><span class="p">(</span><span class="nx">audio</span><span class="o">:</span><span class="w"> </span><span class="kt">Audio</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Audio</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>3. IFormRepository</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">IFormRepository</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nx">save</span><span class="p">(</span><span class="nx">form</span><span class="o">:</span><span class="w"> </span><span class="kt">Form</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Form</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Form</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span><span class="nx">findByInspection</span><span class="p">(</span><span class="nx">inspection_id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Form</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">  </span><span class="nx">findByCompany</span><span class="p">(</span><span class="nx">company_id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Form</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">  </span><span class="nx">update</span><span class="p">(</span><span class="nx">form</span><span class="o">:</span><span class="w"> </span><span class="kt">Form</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Form</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>4. IUserRepository</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">IUserRepository</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="nx">save</span><span class="p">(</span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span><span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">User</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">  </span><span class="nx">findByEmail</span><span class="p">(</span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">company_id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">User</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="nx">findByCompany</span><span class="p">(</span><span class="nx">company_id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">User</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">  </span><span class="nx">existsByEmail</span><span class="p">(</span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">company_id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">boolean</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">  </span><span class="nx">update</span><span class="p">(</span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="p">}</span>
</code></pre></div></p>
<hr />
<h4 id="domain-services-logica-de-negocio-complexa">Domain Services (Lógica de Negócio Complexa)<a class="headerlink" href="#domain-services-logica-de-negocio-complexa" title="Permanent link">&para;</a></h4>
<p><strong>1. TranscriptionQualityService</strong>
- <strong>Responsabilidade:</strong> Avaliar qualidade de transcrição e sugerir ações
- <strong>Métodos:</strong>
  - <code>assessQuality(transcription: Transcription): QualityReport</code>
  - <code>shouldRefineWithCloud(transcription: Transcription): boolean</code>
  - <code>suggestReRecording(transcription: Transcription): boolean</code></p>
<p><strong>Regras:</strong>
- Confidence &lt; 0.70 → sugerir re-gravação
- Confidence 0.70-0.84 → sugerir refinamento cloud
- Confidence ≥ 0.85 → qualidade aceitável</p>
<hr />
<h3 id="camada-2-application-layer">CAMADA 2: APPLICATION LAYER<a class="headerlink" href="#camada-2-application-layer" title="Permanent link">&para;</a></h3>
<h4 id="use-cases-1-por-funcionalidade-principal">Use Cases (1 por funcionalidade principal)<a class="headerlink" href="#use-cases-1-por-funcionalidade-principal" title="Permanent link">&para;</a></h4>
<p><strong>1. ProcessAudioLocalUseCase</strong>
- <strong>Input:</strong> ProcessAudioInputDTO (inspection_id, audio_file, transcription_text, confidence)
- <strong>Output:</strong> ProcessAudioOutputDTO (audio_id, transcription_id, status)
- <strong>Responsabilidade:</strong> Processa áudio capturado no device com IA local, armazena transcrição, atualiza inspeção
- <strong>Fluxo:</strong>
  1. Valida inspection_id existe e pertence a company_id do usuário autenticado
  2. Cria Entity Audio com validações (duration, size, format)
  3. Upload áudio para Storage via IStoragePort
  4. Cria Entity Transcription com source=LOCAL_DEVICE
  5. Salva Audio via IAudioRepository
  6. Salva Transcription (vinculada ao Audio)
  7. Atualiza status Inspection para PENDING (se ainda DRAFT)
  8. Retorna IDs gerados</p>
<p><strong>2. RefineAudioCloudUseCase</strong>
- <strong>Input:</strong> RefineTranscriptionInputDTO (audio_id, company_id)
- <strong>Output:</strong> RefineTranscriptionOutputDTO (transcription_id, refined_text, fields_filled)
- <strong>Responsabilidade:</strong> Refina transcrição local com IA cloud (Groq/OpenAI/Azure), preenche formulário estruturado
- <strong>Fluxo:</strong>
  1. Busca Audio via IAudioRepository, valida existe
  2. Busca Transcription via audio_id
  3. Download áudio do Storage via IStoragePort
  4. Transcreve áudio via ITranscriptionPort (Groq Whisper Cloud)
  5. Busca contexto RAG da empresa via IRAGPort (top 5 documentos normas)
  6. Combina transcrição + contexto RAG, envia para LLM via ILLMPort (Groq LLaMA)
  7. Parseia resposta JSON estruturada (campos preenchidos)
  8. Atualiza Transcription (refine, source=CLOUD_GROQ)
  9. Atualiza Form fields via IFormRepository
  10. Retorna campos preenchidos</p>
<p><strong>3. SyncFormUseCase</strong>
- <strong>Input:</strong> SyncFormInputDTO (inspection_id, fields: object, device_updated_at)
- <strong>Output:</strong> SyncFormOutputDTO (form_id, server_updated_at, conflicts: object)
- <strong>Responsabilidade:</strong> Sincroniza formulário preenchido offline (device → cloud), resolve conflitos
- <strong>Fluxo:</strong>
  1. Busca Form via inspection_id
  2. Compara device_updated_at vs server updated_at
  3. Se server mais recente: detecta conflitos campo a campo
  4. Merge fields (prioridade: servidor, exceto campos nunca editados no servidor)
  5. Recalcula completeness_percentage
  6. Salva Form via IFormRepository
  7. Retorna conflitos detectados (se houver)</p>
<p><strong>4. ValidateFormUseCase</strong>
- <strong>Input:</strong> ValidateFormInputDTO (form_id)
- <strong>Output:</strong> ValidateFormOutputDTO (is_valid, errors: object[], completeness_percentage)
- <strong>Responsabilidade:</strong> Valida completude de formulário + regras de negócio específicas do template
- <strong>Fluxo:</strong>
  1. Busca Form via IFormRepository
  2. Busca Template da empresa (campos obrigatórios, tipos, validações)
  3. Valida cada campo obrigatório preenchido
  4. Valida tipos de dados (string, number, date, enum)
  5. Valida regras negócio (ex: "data_inspecao ≤ hoje", "valor_medido entre min e max")
  6. Calcula completeness_percentage
  7. Atualiza status Form (INCOMPLETE ou COMPLETE)
  8. Retorna erros encontrados</p>
<p><strong>5. GeneratePDFUseCase</strong>
- <strong>Input:</strong> GeneratePDFInputDTO (inspection_id)
- <strong>Output:</strong> GeneratePDFOutputDTO (pdf_url, generated_at)
- <strong>Responsabilidade:</strong> Gera relatório PDF da inspeção com formulário preenchido + evidências (fotos, áudios, transcrições)
- <strong>Fluxo:</strong>
  1. Busca Inspection completa (com Form, Audios, Transcriptions, Photos)
  2. Valida status = APPROVED (apenas inspeções aprovadas geram PDF)
  3. Renderiza template PDF (HTML → PDF via Puppeteer/Playwright)
  4. Inclui: cabeçalho empresa, dados inspeção, formulário completo, fotos inline, link áudios
  5. Upload PDF para Storage via IStoragePort
  6. Atualiza Inspection com pdf_url
  7. Retorna URL do PDF</p>
<p><strong>6. AuthenticateUserUseCase</strong>
- <strong>Input:</strong> AuthenticateInputDTO (email, password, company_id)
- <strong>Output:</strong> AuthenticateOutputDTO (user_id, access_token, refresh_token, role)
- <strong>Responsabilidade:</strong> Valida credenciais multi-tenant, gera JWT tokens
- <strong>Fluxo:</strong>
  1. Busca User via IUserRepository.findByEmail(email, company_id)
  2. Valida user existe e active = true
  3. Valida password via user.validatePassword(password)
  4. Atualiza user.last_login_at
  5. Gera JWT tokens via IAuthPort (access: 1h, refresh: 7 dias)
  6. Retorna tokens + user_id + role</p>
<hr />
<h4 id="application-ports-interfaces-para-infrastructure">Application Ports (Interfaces para Infrastructure)<a class="headerlink" href="#application-ports-interfaces-para-infrastructure" title="Permanent link">&para;</a></h4>
<p><strong>1. ITranscriptionPort</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">ITranscriptionPort</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="nx">transcribe</span><span class="p">(</span><span class="nx">audio</span><span class="o">:</span><span class="w"> </span><span class="kt">Buffer</span><span class="p">,</span><span class="w"> </span><span class="nx">language?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">TranscriptionResult</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="c1">// TranscriptionResult: { text: string, confidence: number, language: string, duration_ms: number }</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>Implementações concretas (Infrastructure):</strong>
- GroqWhisperAdapter (Groq Whisper Large V3)
- OpenAIWhisperAdapter (OpenAI Whisper)
- AzureWhisperAdapter (Azure OpenAI Whisper)</p>
<hr />
<p><strong>2. ILLMPort</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">ILLMPort</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="nx">complete</span><span class="p">(</span><span class="nx">prompt</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">context?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">schema?</span><span class="o">:</span><span class="w"> </span><span class="kt">object</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">CompletionResult</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="c1">// CompletionResult: { text: string, structured_data?: object, tokens_used: number }</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>Implementações concretas:</strong>
- GroqLlamaAdapter (Groq LLaMA 3.3 70B)
- GPT4Adapter (OpenAI GPT-4 Turbo)
- ClaudeAdapter (Anthropic Claude 3.5 Sonnet)</p>
<hr />
<p><strong>3. IRAGPort</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">IRAGPort</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span><span class="nx">search</span><span class="p">(</span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">company_id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">,</span><span class="w"> </span><span class="nx">top_k?</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">threshold?</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Document</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">  </span><span class="nx">upsertDocuments</span><span class="p">(</span><span class="nx">documents</span><span class="o">:</span><span class="w"> </span><span class="kt">Document</span><span class="p">[],</span><span class="w"> </span><span class="nx">company_id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">  </span><span class="nx">deleteDocuments</span><span class="p">(</span><span class="nx">document_ids</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">[],</span><span class="w"> </span><span class="nx">company_id</span><span class="o">:</span><span class="w"> </span><span class="kt">UUID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">  </span><span class="c1">// Document: { id: UUID, text: string, metadata: object, similarity_score: number }</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>Implementação concreta:</strong>
- SupabaseVectorAdapter (pgvector 0.5 + PostgreSQL 15)</p>
<hr />
<p><strong>4. IStoragePort</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">IStoragePort</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="nx">upload</span><span class="p">(</span><span class="nx">file</span><span class="o">:</span><span class="w"> </span><span class="kt">Buffer</span><span class="p">,</span><span class="w"> </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">content_type</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// retorna URL</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">  </span><span class="nx">download</span><span class="p">(</span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Buffer</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="ow">delete</span><span class="p">(</span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="nx">getSignedUrl</span><span class="p">(</span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">expires_in_seconds?</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>Implementação concreta:</strong>
- SupabaseStorageAdapter (Supabase Storage S3 Compatible)</p>
<hr />
<p><strong>5. IAuthPort</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">IAuthPort</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="nx">validateJWT</span><span class="p">(</span><span class="nx">token</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">JWTPayload</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">  </span><span class="nx">generateJWT</span><span class="p">(</span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="p">,</span><span class="w"> </span><span class="nx">expires_in?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">TokenPair</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="nx">refreshJWT</span><span class="p">(</span><span class="nx">refresh_token</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">TokenPair</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">  </span><span class="c1">// TokenPair: { access_token: string, refresh_token: string }</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">  </span><span class="c1">// JWTPayload: { user_id: UUID, company_id: UUID, role: string, exp: number }</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>Implementação concreta:</strong>
- SupabaseAuthAdapter (Supabase Auth JWT)</p>
<hr />
<h4 id="dtos-data-transfer-objects">DTOs (Data Transfer Objects)<a class="headerlink" href="#dtos-data-transfer-objects" title="Permanent link">&para;</a></h4>
<p><strong>Input DTOs:</strong>
- ProcessAudioInputDTO
- RefineTranscriptionInputDTO
- SyncFormInputDTO
- ValidateFormInputDTO
- GeneratePDFInputDTO
- AuthenticateInputDTO</p>
<p><strong>Output DTOs:</strong>
- ProcessAudioOutputDTO
- RefineTranscriptionOutputDTO
- SyncFormOutputDTO
- ValidateFormOutputDTO
- GeneratePDFOutputDTO
- AuthenticateOutputDTO</p>
<hr />
<h3 id="camada-3-infrastructure-layer">CAMADA 3: INFRASTRUCTURE LAYER<a class="headerlink" href="#camada-3-infrastructure-layer" title="Permanent link">&para;</a></h3>
<h4 id="ia-adapters-implementam-application-ports">IA Adapters (Implementam Application Ports)<a class="headerlink" href="#ia-adapters-implementam-application-ports" title="Permanent link">&para;</a></h4>
<p><strong>1. GroqWhisperAdapter</strong> (implementa ITranscriptionPort)
- <strong>Tecnologia:</strong> Groq API - Whisper Large V3
- <strong>Responsabilidade:</strong> Transcrição de áudio via Groq (provider primário MVP)
- <strong>Configuração:</strong> API Key via env variable, endpoint https://api.groq.com/openai/v1/audio/transcriptions
- <strong>Latência esperada:</strong> &lt;3s para áudios até 5 minutos
- <strong>Custo:</strong> $0.111/hora áudio (vs OpenAI $0.36)</p>
<p><strong>2. OpenAIWhisperAdapter</strong> (implementa ITranscriptionPort)
- <strong>Tecnologia:</strong> OpenAI API - Whisper
- <strong>Responsabilidade:</strong> Transcrição fallback quando Groq falha ou A/B testing
- <strong>Configuração:</strong> API Key via env variable</p>
<p><strong>3. AzureWhisperAdapter</strong> (implementa ITranscriptionPort)
- <strong>Tecnologia:</strong> Azure OpenAI Service - Whisper
- <strong>Responsabilidade:</strong> Transcrição para clientes governo (compliance LGPD + dados Brasil)
- <strong>Configuração:</strong> Endpoint Azure, OAuth token</p>
<p><strong>4. GroqLlamaAdapter</strong> (implementa ILLMPort)
- <strong>Tecnologia:</strong> Groq API - LLaMA 3.3 70B
- <strong>Responsabilidade:</strong> Preenchimento estruturado de formulários via LLM
- <strong>Latência esperada:</strong> &lt;2s para prompts até 4k tokens
- <strong>Custo:</strong> $0.59/1M tokens input (vs GPT-4 $10/1M)</p>
<p><strong>5. GPT4Adapter</strong> (implementa ILLMPort)
- <strong>Tecnologia:</strong> OpenAI API - GPT-4 Turbo
- <strong>Responsabilidade:</strong> Fallback LLM quando LLaMA falha ou maior precisão necessária</p>
<p><strong>6. ClaudeAdapter</strong> (implementa ILLMPort)
- <strong>Tecnologia:</strong> Anthropic API - Claude 3.5 Sonnet
- <strong>Responsabilidade:</strong> Alternativa LLM para testes A/B (melhor em português)</p>
<hr />
<h4 id="data-adapters-implementam-application-ports">Data Adapters (Implementam Application Ports)<a class="headerlink" href="#data-adapters-implementam-application-ports" title="Permanent link">&para;</a></h4>
<p><strong>7. SupabaseVectorAdapter</strong> (implementa IRAGPort)
- <strong>Tecnologia:</strong> Supabase PostgreSQL 15 + pgvector 0.5
- <strong>Responsabilidade:</strong> Busca vetorial (RAG) na base de conhecimento da empresa
- <strong>Tabela:</strong> <code>rag_documents</code> (id, company_id, text, embedding vector(1536), metadata jsonb)
- <strong>Query:</strong> <code>SELECT *, 1 - (embedding &lt;=&gt; query_embedding) as similarity FROM rag_documents WHERE company_id = $1 ORDER BY similarity DESC LIMIT 5</code>
- <strong>Performance:</strong> 50-150ms para busca vetorial (vs Pinecone 200-300ms)</p>
<p><strong>8. SupabaseStorageAdapter</strong> (implementa IStoragePort)
- <strong>Tecnologia:</strong> Supabase Storage (S3 Compatible)
- <strong>Responsabilidade:</strong> Upload/download de áudios, PDFs, fotos
- <strong>Buckets:</strong> <code>audios</code> (TTL 30 dias), <code>pdfs</code> (permanente), <code>photos</code> (permanente)
- <strong>RLS:</strong> Row-Level Security por company_id</p>
<p><strong>9. SupabaseAuthAdapter</strong> (implementa IAuthPort)
- <strong>Tecnologia:</strong> Supabase Auth (JWT)
- <strong>Responsabilidade:</strong> Validação de tokens JWT, geração de tokens
- <strong>Configuração:</strong> Secret key via env variable, algoritmo HS256</p>
<p><strong>10. RedisCacheAdapter</strong>
- <strong>Tecnologia:</strong> Upstash Redis 7.2 Serverless
- <strong>Responsabilidade:</strong> Cache de queries RAG (5min TTL) + sessões de autenticação (1h TTL)
- <strong>Chaves:</strong> <code>rag:${company_id}:${query_hash}</code>, <code>session:${user_id}</code></p>
<hr />
<h4 id="repository-implementations-implementam-domain-ports">Repository Implementations (Implementam Domain Ports)<a class="headerlink" href="#repository-implementations-implementam-domain-ports" title="Permanent link">&para;</a></h4>
<p><strong>11. SupabaseInspectionRepository</strong> (implementa IInspectionRepository)
- <strong>Tecnologia:</strong> Supabase PostgreSQL 15 via Supabase JS Client
- <strong>Tabela:</strong> <code>inspections</code>
- <strong>Métodos:</strong> save(), findById(), findByCompany(), findPendingApproval(), update()
- <strong>RLS:</strong> Filtra automaticamente por company_id (Row-Level Security)</p>
<p><strong>12. SupabaseAudioRepository</strong> (implementa IAudioRepository)
- <strong>Tabela:</strong> <code>audios</code>
- <strong>Relacionamento:</strong> FK inspection_id → inspections.id</p>
<p><strong>13. SupabaseFormRepository</strong> (implementa IFormRepository)
- <strong>Tabela:</strong> <code>forms</code>
- <strong>JSONB:</strong> Campo <code>fields</code> armazena dados dinâmicos do formulário</p>
<p><strong>14. SupabaseUserRepository</strong> (implementa IUserRepository)
- <strong>Tabela:</strong> <code>users</code>
- <strong>Índices:</strong> UNIQUE (email, company_id), INDEX (company_id)</p>
<hr />
<h4 id="integration-adapters">Integration Adapters<a class="headerlink" href="#integration-adapters" title="Permanent link">&para;</a></h4>
<p><strong>15. KaffaAdapter</strong>
- <strong>Tecnologia:</strong> Android Intent callbacks
- <strong>Responsabilidade:</strong> Comunicação bidirecional com Kaffa Android SDK
- <strong>Métodos:</strong>
  - <code>sendFieldsToKaffa(fields: object)</code> - Envia campos preenchidos via Intent callback
  - <code>receiveAudioFromKaffa(intent: object)</code> - Recebe áudio do Kaffa via Intent</p>
<hr />
<h3 id="camada-4-presentation-layer">CAMADA 4: PRESENTATION LAYER<a class="headerlink" href="#camada-4-presentation-layer" title="Permanent link">&para;</a></h3>
<h4 id="controllers-endpoints-rest-fastify-routers">Controllers (Endpoints REST - Fastify Routers)<a class="headerlink" href="#controllers-endpoints-rest-fastify-routers" title="Permanent link">&para;</a></h4>
<p><strong>1. AudioController</strong>
- <strong>Base path:</strong> <code>/api/v1/audio</code>
- <strong>Endpoints:</strong>
  - <code>POST /api/v1/audio/upload</code> - Upload áudio (multipart/form-data, max 50MB)
    - <strong>Input:</strong> audio_file (File), inspection_id (UUID)
    - <strong>Chama:</strong> ProcessAudioLocalUseCase
    - <strong>Auth:</strong> JWT required
    - <strong>Response:</strong> 201 Created + { audio_id, status }</p>
<ul>
<li><code>POST /api/v1/audio/process</code> - Processa áudio local (device enviou transcrição pronta)<ul>
<li><strong>Input:</strong> { inspection_id, transcription_text, confidence, audio_metadata }</li>
<li><strong>Chama:</strong> ProcessAudioLocalUseCase</li>
<li><strong>Auth:</strong> JWT required</li>
<li><strong>Response:</strong> 201 Created + { audio_id, transcription_id }</li>
</ul>
</li>
</ul>
<p><strong>2. TranscriptionController</strong>
- <strong>Base path:</strong> <code>/api/v1/transcription</code>
- <strong>Endpoints:</strong>
  - <code>POST /api/v1/transcription/refine</code> - Refina transcrição local com IA cloud
    - <strong>Input:</strong> { audio_id }
    - <strong>Chama:</strong> RefineAudioCloudUseCase
    - <strong>Auth:</strong> JWT required
    - <strong>Response:</strong> 200 OK + { transcription_id, refined_text, fields_filled }</p>
<ul>
<li><code>GET /api/v1/transcription/:id</code> - Busca transcrição por ID<ul>
<li><strong>Chama:</strong> Repository direto (query simples)</li>
<li><strong>Auth:</strong> JWT required</li>
<li><strong>Response:</strong> 200 OK + { transcription }</li>
</ul>
</li>
</ul>
<p><strong>3. InspectionController</strong>
- <strong>Base path:</strong> <code>/api/v1/inspections</code>
- <strong>Endpoints:</strong>
  - <code>GET /api/v1/inspections</code> - Lista inspeções (filtros: status, date range)
    - <strong>Query params:</strong> status, start_date, end_date, inspector_id
    - <strong>Chama:</strong> Repository findByCompany()
    - <strong>Auth:</strong> JWT required
    - <strong>RLS:</strong> Filtra automaticamente por company_id do token
    - <strong>Response:</strong> 200 OK + { inspections: [] }</p>
<ul>
<li>
<p><code>GET /api/v1/inspections/:id</code> - Detalhes inspeção completa</p>
<ul>
<li><strong>Chama:</strong> Repository findById() + joins (form, audios, transcriptions)</li>
<li><strong>Auth:</strong> JWT required</li>
<li><strong>Response:</strong> 200 OK + { inspection }</li>
</ul>
</li>
<li>
<p><code>POST /api/v1/inspections</code> - Criar inspeção manual (sem áudio)</p>
<ul>
<li><strong>Input:</strong> { inspector_id, form_template_id }</li>
<li><strong>Cria:</strong> Entity Inspection + Form vazio</li>
<li><strong>Auth:</strong> JWT required</li>
<li><strong>Response:</strong> 201 Created + { inspection_id }</li>
</ul>
</li>
<li>
<p><code>PATCH /api/v1/inspections/:id</code> - Atualizar status</p>
<ul>
<li><strong>Input:</strong> { status: "APPROVED" | "REJECTED", reason? }</li>
<li><strong>Valida:</strong> Role SUPERVISOR required</li>
<li><strong>Chama:</strong> Inspection.approve() ou Inspection.reject()</li>
<li><strong>Auth:</strong> JWT required (role check)</li>
<li><strong>Response:</strong> 200 OK + { inspection }</li>
</ul>
</li>
</ul>
<p><strong>4. FormController</strong>
- <strong>Base path:</strong> <code>/api/v1/forms</code>
- <strong>Endpoints:</strong>
  - <code>GET /api/v1/forms/:id</code> - Busca formulário por ID
    - <strong>Response:</strong> 200 OK + { form }</p>
<ul>
<li>
<p><code>POST /api/v1/forms/sync</code> - Sincroniza formulário offline→online</p>
<ul>
<li><strong>Input:</strong> { inspection_id, fields, device_updated_at }</li>
<li><strong>Chama:</strong> SyncFormUseCase</li>
<li><strong>Response:</strong> 200 OK + { form_id, conflicts }</li>
</ul>
</li>
<li>
<p><code>POST /api/v1/forms/:id/validate</code> - Valida completude formulário</p>
<ul>
<li><strong>Chama:</strong> ValidateFormUseCase</li>
<li><strong>Response:</strong> 200 OK + { is_valid, errors, completeness_percentage }</li>
</ul>
</li>
</ul>
<p><strong>5. AuthController</strong>
- <strong>Base path:</strong> <code>/api/v1/auth</code>
- <strong>Endpoints:</strong>
  - <code>POST /api/v1/auth/login</code> - Autenticação
    - <strong>Input:</strong> { email, password, company_id }
    - <strong>Chama:</strong> AuthenticateUserUseCase
    - <strong>Response:</strong> 200 OK + { access_token, refresh_token, user }</p>
<ul>
<li>
<p><code>POST /api/v1/auth/refresh</code> - Renovar token JWT</p>
<ul>
<li><strong>Input:</strong> { refresh_token }</li>
<li><strong>Chama:</strong> IAuthPort.refreshJWT()</li>
<li><strong>Response:</strong> 200 OK + { access_token }</li>
</ul>
</li>
<li>
<p><code>GET /api/v1/auth/me</code> - Perfil usuário autenticado</p>
<ul>
<li><strong>Auth:</strong> JWT required</li>
<li><strong>Response:</strong> 200 OK + { user }</li>
</ul>
</li>
</ul>
<p><strong>6. IntegrationController</strong>
- <strong>Base path:</strong> <code>/api/v1/integration</code>
- <strong>Endpoints:</strong>
  - <code>POST /api/v1/integration/kaffa/callback</code> - Recebe callback do Kaffa SDK
    - <strong>Input:</strong> { audio_data, inspection_id, metadata }
    - <strong>Chama:</strong> ProcessAudioLocalUseCase
    - <strong>Auth:</strong> API Key (não JWT, integration específica)
    - <strong>Response:</strong> 200 OK + { fields_filled }</p>
<hr />
<h4 id="middlewares">Middlewares<a class="headerlink" href="#middlewares" title="Permanent link">&para;</a></h4>
<p><strong>1. AuthMiddleware (JWT Validation)</strong>
- <strong>Responsabilidade:</strong> Valida token JWT em todas rotas protegidas
- <strong>Implementação:</strong>
  - Extrai token do header <code>Authorization: Bearer &lt;token&gt;</code>
  - Valida via IAuthPort.validateJWT()
  - Injeta payload (user_id, company_id, role) no request context
  - Retorna 401 Unauthorized se token inválido/expirado</p>
<p><strong>2. TenantMiddleware (RLS Context Injection)</strong>
- <strong>Responsabilidade:</strong> Injeta company_id do usuário autenticado no contexto RLS do Supabase
- <strong>Implementação:</strong>
  - Extrai company_id do JWT payload
  - Configura RLS: <code>SET LOCAL rls.company_id = '${company_id}'</code>
  - Garante que queries retornam apenas dados da empresa do usuário</p>
<p><strong>3. RateLimitMiddleware</strong>
- <strong>Responsabilidade:</strong> Limita requisições por IP/usuário (100 req/min)
- <strong>Implementação:</strong>
  - Armazena contador no Redis (chave: <code>rate_limit:${ip}:${minute}</code>)
  - Retorna 429 Too Many Requests se exceder limite
  - Headers: <code>X-RateLimit-Limit: 100</code>, <code>X-RateLimit-Remaining: 45</code></p>
<hr />
<h4 id="schemas-validacao-requestresponse-zod">Schemas (Validação Request/Response - Zod)<a class="headerlink" href="#schemas-validacao-requestresponse-zod" title="Permanent link">&para;</a></h4>
<p><strong>Request Schemas:</strong>
- ProcessAudioRequestSchema (valida multipart file + inspection_id UUID)
- RefineTranscriptionRequestSchema (valida audio_id UUID)
- SyncFormRequestSchema (valida fields object + device_updated_at ISO date)
- AuthenticateRequestSchema (valida email format + password min 8 chars)</p>
<p><strong>Response Schemas:</strong>
- InspectionResponseSchema
- TranscriptionResponseSchema
- FormResponseSchema
- ErrorResponseSchema (padroniza erros: { error: string, code: string, details?: object })</p>
<hr />
<h2 id="4-matriz-de-dependencias">4. MATRIZ DE DEPENDÊNCIAS<a class="headerlink" href="#4-matriz-de-dependencias" title="Permanent link">&para;</a></h2>
<h3 id="regra-da-hexagonal-architecture">Regra da Hexagonal Architecture<a class="headerlink" href="#regra-da-hexagonal-architecture" title="Permanent link">&para;</a></h3>
<p><strong>Princípio:</strong> Dependências apontam PARA DENTRO (de camadas externas para internas). Domain Core não depende de NADA.</p>
<table>
<thead>
<tr>
<th>Camada</th>
<th>Domain Core</th>
<th>Application</th>
<th>Infrastructure</th>
<th>Presentation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Domain Core</strong></td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td><strong>Application</strong></td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td><strong>Infrastructure</strong></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td><strong>Presentation</strong></td>
<td>❌</td>
<td>✅</td>
<td>✅*</td>
<td>✅</td>
</tr>
</tbody>
</table>
<p><strong>Legenda:</strong>
- ✅ = Pode importar diretamente
- ❌ = NÃO pode importar (violação do padrão)
- ✅* = Apenas via Dependency Injection (não import direto de classes concretas)</p>
<hr />
<h3 id="explicacao-detalhada">Explicação Detalhada<a class="headerlink" href="#explicacao-detalhada" title="Permanent link">&para;</a></h3>
<p><strong>1. Domain Core → NADA</strong>
- Domain Core é 100% puro (zero dependências externas)
- Não importa: Fastify, Supabase, Groq, Node.js libs (exceto TypeScript std lib)
- Testável isoladamente (sem mocks de infraestrutura)</p>
<p><strong>2. Application → Domain Core</strong>
- Use Cases importam Entities, Value Objects, Repository Interfaces
- Use Cases orquestram Domain Core
- Application Ports são interfaces abstratas (não conhecem implementações)</p>
<p><strong>3. Infrastructure → Domain Core + Application</strong>
- Adapters implementam Ports (interfaces)
- Adapters conhecem tecnologias concretas (Groq, Supabase, Redis)
- Repository Implementations implementam Domain Ports</p>
<p><strong>4. Presentation → Application + Infrastructure (via DI)</strong>
- Controllers chamam Use Cases
- Controllers NÃO importam Adapters concretos (usam Dependency Injection)
- Middlewares podem usar Ports (via DI)</p>
<hr />
<h3 id="exemplos-de-codigo">Exemplos de Código<a class="headerlink" href="#exemplos-de-codigo" title="Permanent link">&para;</a></h3>
<h4 id="correto-application-importa-domain">✅ CORRETO: Application importa Domain<a class="headerlink" href="#correto-application-importa-domain" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1">// application/use-cases/RefineAudioCloudUseCase.ts</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Audio</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@domain/entities/Audio&#39;</span><span class="p">;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Transcription</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@domain/entities/Transcription&#39;</span><span class="p">;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">IAudioRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@domain/ports/IAudioRepository&#39;</span><span class="p">;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ITranscriptionPort</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@application/ports/ITranscriptionPort&#39;</span><span class="p">;</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ILLMPort</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@application/ports/ILLMPort&#39;</span><span class="p">;</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">IRAGPort</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@application/ports/IRAGPort&#39;</span><span class="p">;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">RefineAudioCloudUseCase</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">audioRepository</span><span class="o">:</span><span class="w"> </span><span class="kt">IAudioRepository</span><span class="p">,</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">transcriptionPort</span><span class="o">:</span><span class="w"> </span><span class="kt">ITranscriptionPort</span><span class="p">,</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">llmPort</span><span class="o">:</span><span class="w"> </span><span class="kt">ILLMPort</span><span class="p">,</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="nx">ragPort</span><span class="o">:</span><span class="w"> </span><span class="kt">IRAGPort</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">execute</span><span class="p">(</span><span class="nx">input</span><span class="o">:</span><span class="w"> </span><span class="kt">RefineInputDTO</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">RefineOutputDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">audio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">audioRepository</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">audio_id</span><span class="p">);</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">    </span><span class="c1">// ... lógica</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="p">}</span>
</code></pre></div>
<p><strong>✅ Correto:</strong> Use Case depende apenas de interfaces (Domain Ports + Application Ports), não de implementações concretas.</p>
<hr />
<h4 id="correto-infrastructure-implementa-application-port">✅ CORRETO: Infrastructure implementa Application Port<a class="headerlink" href="#correto-infrastructure-implementa-application-port" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1">// infrastructure/adapters/ia/GroqWhisperAdapter.ts</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ITranscriptionPort</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@application/ports/ITranscriptionPort&#39;</span><span class="p">;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">TranscriptionResult</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@application/dtos/TranscriptionResult&#39;</span><span class="p">;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="k">import</span><span class="w"> </span><span class="nx">Groq</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;groq-sdk&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// ✅ Adapter pode importar lib externa</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">GroqWhisperAdapter</span><span class="w"> </span><span class="k">implements</span><span class="w"> </span><span class="nx">ITranscriptionPort</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">groqClient</span><span class="o">:</span><span class="w"> </span><span class="kt">Groq</span><span class="p">;</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">apiKey</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">groqClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Groq</span><span class="p">({</span><span class="w"> </span><span class="nx">apiKey</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">transcribe</span><span class="p">(</span><span class="nx">audio</span><span class="o">:</span><span class="w"> </span><span class="kt">Buffer</span><span class="p">,</span><span class="w"> </span><span class="nx">language?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">TranscriptionResult</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">groqClient</span><span class="p">.</span><span class="nx">audio</span><span class="p">.</span><span class="nx">transcriptions</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">      </span><span class="nx">file</span><span class="o">:</span><span class="w"> </span><span class="kt">audio</span><span class="p">,</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">      </span><span class="nx">model</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;whisper-large-v3&#39;</span><span class="p">,</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">      </span><span class="nx">language</span><span class="o">:</span><span class="w"> </span><span class="kt">language</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;pt&#39;</span><span class="p">,</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">response.text</span><span class="p">,</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="w">      </span><span class="nx">confidence</span><span class="o">:</span><span class="w"> </span><span class="kt">0.9</span><span class="p">,</span><span class="w"> </span><span class="c1">// Groq não retorna confidence, assumir alto</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="w">      </span><span class="nx">language</span><span class="o">:</span><span class="w"> </span><span class="kt">language</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;pt&#39;</span><span class="p">,</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="w">      </span><span class="nx">duration_ms</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// calcular se necessário</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="p">}</span>
</code></pre></div>
<p><strong>✅ Correto:</strong> Adapter implementa interface abstrata (ITranscriptionPort) e importa lib externa (groq-sdk). Domain/Application não conhecem Groq.</p>
<hr />
<h4 id="correto-presentation-injeta-dependencias-via-di-container">✅ CORRETO: Presentation injeta dependências via DI Container<a class="headerlink" href="#correto-presentation-injeta-dependencias-via-di-container" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1">// presentation/controllers/TranscriptionController.ts</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">FastifyRequest</span><span class="p">,</span><span class="w"> </span><span class="nx">FastifyReply</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;fastify&#39;</span><span class="p">;</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">RefineAudioCloudUseCase</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@application/use-cases/RefineAudioCloudUseCase&#39;</span><span class="p">;</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">TranscriptionController</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="k">private</span><span class="w"> </span><span class="nx">refineUseCase</span><span class="o">:</span><span class="w"> </span><span class="kt">RefineAudioCloudUseCase</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// ✅ Injeta Use Case</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">refine</span><span class="p">(</span><span class="nx">request</span><span class="o">:</span><span class="w"> </span><span class="kt">FastifyRequest</span><span class="p">,</span><span class="w"> </span><span class="nx">reply</span><span class="o">:</span><span class="w"> </span><span class="kt">FastifyReply</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">audio_id</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">audio_id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">refineUseCase</span><span class="p">.</span><span class="nx">execute</span><span class="p">({</span><span class="w"> </span><span class="nx">audio_id</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">reply</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">200</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1">// presentation/di-container.ts (Dependency Injection)</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">RefineAudioCloudUseCase</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@application/use-cases/RefineAudioCloudUseCase&#39;</span><span class="p">;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">GroqWhisperAdapter</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@infrastructure/adapters/ia/GroqWhisperAdapter&#39;</span><span class="p">;</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">GroqLlamaAdapter</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@infrastructure/adapters/ia/GroqLlamaAdapter&#39;</span><span class="p">;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">SupabaseVectorAdapter</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@infrastructure/adapters/data/SupabaseVectorAdapter&#39;</span><span class="p">;</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">SupabaseAudioRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@infrastructure/repositories/SupabaseAudioRepository&#39;</span><span class="p">;</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="c1">// ✅ Container configura bindings (escolhe implementações concretas)</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">createRefineUseCase</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">RefineAudioCloudUseCase</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">audioRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SupabaseAudioRepository</span><span class="p">();</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">transcriptionPort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GroqWhisperAdapter</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">GROQ_API_KEY</span><span class="p">);</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">llmPort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GroqLlamaAdapter</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">GROQ_API_KEY</span><span class="p">);</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">ragPort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SupabaseVectorAdapter</span><span class="p">();</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RefineAudioCloudUseCase</span><span class="p">(</span><span class="nx">audioRepository</span><span class="p">,</span><span class="w"> </span><span class="nx">transcriptionPort</span><span class="p">,</span><span class="w"> </span><span class="nx">llmPort</span><span class="p">,</span><span class="w"> </span><span class="nx">ragPort</span><span class="p">);</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="p">}</span>
</code></pre></div>
<p><strong>✅ Correto:</strong> Controller não conhece Adapters concretos (GroqWhisperAdapter). DI Container configura bindings. Trocar Groq → OpenAI = alterar DI Container, NÃO tocar Controller ou Use Case.</p>
<hr />
<h4 id="errado-domain-importa-infrastructure">❌ ERRADO: Domain importa Infrastructure<a class="headerlink" href="#errado-domain-importa-infrastructure" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1">// ❌ domain/entities/Audio.ts</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">SupabaseClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@supabase/supabase-js&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// ❌ PROIBIDO!</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Audio</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">  </span><span class="nx">file_url</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">saveToDatabase</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">supabase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SupabaseClient</span><span class="p">(...);</span><span class="w"> </span><span class="c1">// ❌ Domain não deve conhecer Supabase!</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">supabase</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="s1">&#39;audios&#39;</span><span class="p">).</span><span class="nx">insert</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="p">}</span>
</code></pre></div>
<p><strong>❌ VIOLAÇÃO:</strong> Domain Core não pode importar bibliotecas externas (Supabase, Fastify, Groq). Persistência deve ser feita via Repository (Infrastructure).</p>
<hr />
<h4 id="errado-application-importa-infrastructure-adapter">❌ ERRADO: Application importa Infrastructure Adapter<a class="headerlink" href="#errado-application-importa-infrastructure-adapter" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1">// ❌ application/use-cases/RefineAudioCloudUseCase.ts</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">GroqWhisperAdapter</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@infrastructure/adapters/ia/GroqWhisperAdapter&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// ❌ ERRADO!</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">RefineAudioCloudUseCase</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">transcriptionService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GroqWhisperAdapter</span><span class="p">(...);</span><span class="w"> </span><span class="c1">// ❌ Application não deve conhecer Adapter concreto!</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="p">}</span>
</code></pre></div>
<p><strong>❌ VIOLAÇÃO:</strong> Use Case deve depender de ITranscriptionPort (interface), não de GroqWhisperAdapter (implementação concreta). Isso impede trocar Groq → OpenAI sem refatorar Use Case.</p>
<p><strong>✅ CORRETO:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ITranscriptionPort</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@application/ports/ITranscriptionPort&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// ✅ Interface</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">RefineAudioCloudUseCase</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="k">private</span><span class="w"> </span><span class="nx">transcriptionPort</span><span class="o">:</span><span class="w"> </span><span class="kt">ITranscriptionPort</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// ✅ Dependency Injection</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="p">}</span>
</code></pre></div></p>
<hr />
<h4 id="errado-presentation-importa-adapter-concreto">❌ ERRADO: Presentation importa Adapter concreto<a class="headerlink" href="#errado-presentation-importa-adapter-concreto" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1">// ❌ presentation/controllers/TranscriptionController.ts</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">GroqWhisperAdapter</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@infrastructure/adapters/ia/GroqWhisperAdapter&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// ❌ ERRADO!</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">TranscriptionController</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">refine</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span><span class="w"> </span><span class="nx">reply</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GroqWhisperAdapter</span><span class="p">(...);</span><span class="w"> </span><span class="c1">// ❌ Controller não deve instanciar Adapter!</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">adapter</span><span class="p">.</span><span class="nx">transcribe</span><span class="p">(...);</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="p">}</span>
</code></pre></div>
<p><strong>❌ VIOLAÇÃO:</strong> Controller deve chamar Use Case, não Adapter diretamente. Use Case orquestra lógica, Controller apenas valida request e serializa response.</p>
<p><strong>✅ CORRETO:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">TranscriptionController</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="k">private</span><span class="w"> </span><span class="nx">refineUseCase</span><span class="o">:</span><span class="w"> </span><span class="kt">RefineAudioCloudUseCase</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// ✅ Injeta Use Case</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">refine</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span><span class="w"> </span><span class="nx">reply</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">refineUseCase</span><span class="p">.</span><span class="nx">execute</span><span class="p">({</span><span class="w"> </span><span class="nx">audio_id</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="c1">// ✅ Chama Use Case</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="p">}</span>
</code></pre></div></p>
<hr />
<h3 id="validacao-da-matriz">Validação da Matriz<a class="headerlink" href="#validacao-da-matriz" title="Permanent link">&para;</a></h3>
<p><strong>Como validar se arquitetura está correta:</strong></p>
<ol>
<li>
<p><strong>Domain Core não deve ter imports externos:</strong>
   <div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># ❌ Se encontrar imports de Fastify, Supabase, Groq, etc em domain/, VIOLAÇÃO!</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>grep<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;from &#39;fastify&#39;&quot;</span><span class="w"> </span>src/domain/
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>grep<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;from &#39;@supabase&quot;</span><span class="w"> </span>src/domain/
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>grep<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;from &#39;groq-sdk&#39;&quot;</span><span class="w"> </span>src/domain/
</code></pre></div></p>
</li>
<li>
<p><strong>Application não deve importar Adapters:</strong>
   <div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># ❌ Se encontrar imports de GroqWhisperAdapter, SupabaseRepository, etc em application/, VIOLAÇÃO!</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>grep<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;from &#39;@infrastructure&quot;</span><span class="w"> </span>src/application/
</code></pre></div></p>
</li>
<li>
<p><strong>Use Cases devem depender de interfaces (Ports):</strong>
   <div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># ✅ Use Cases importam ITranscriptionPort, não GroqWhisperAdapter</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>grep<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;ITranscriptionPort&quot;</span><span class="w"> </span>src/application/use-cases/
</code></pre></div></p>
</li>
<li>
<p><strong>Presentation não deve importar Adapters concretos:</strong>
   <div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># ❌ Se Controllers importam GroqWhisperAdapter, VIOLAÇÃO!</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>grep<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;GroqWhisperAdapter&quot;</span><span class="w"> </span>src/presentation/
</code></pre></div></p>
</li>
</ol>
<hr />
<p><strong>Última atualização:</strong> 2026-02-01<br />
<strong>Versão:</strong> 1.0</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Voltar para o topo
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Rodapé" >
        
          
          <a href="../DONE_3_03_c4_container/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: [31] DIAGRAMA C4 NÍVEL 2 (CONTAINER) - VoiceCap">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Anterior
              </span>
              <div class="md-ellipsis">
                [31] DIAGRAMA C4 NÍVEL 2 (CONTAINER) - VoiceCap
              </div>
            </div>
          </a>
        
        
          
          <a href="../DONE_3_04_02_fluxos_validacao/" class="md-footer__link md-footer__link--next" aria-label="Próximo: [33] DIAGRAMA C4 COMPONENT - FLUXOS E VALIDAÇÃO">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Próximo
              </span>
              <div class="md-ellipsis">
                [33] DIAGRAMA C4 COMPONENT - FLUXOS E VALIDAÇÃO
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2026 VoiceCap - Desenvolvido com Metodologia MDSIA
    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/voicecap" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://voicecap.com.br" target="_blank" rel="noopener" title="voicecap.com.br" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M351.9 280H161c2.9 64.5 17.2 123.9 37.5 167.4 11.4 24.5 23.7 41.8 35.1 52.4 11.2 10.5 18.9 12.2 22.9 12.2s11.7-1.7 22.9-12.2c11.4-10.6 23.7-28 35.1-52.4 20.3-43.5 34.6-102.9 37.5-167.4zm-191-48h190.9c-2.8-64.5-17.1-123.9-37.4-167.4-11.4-24.4-23.7-41.8-35.1-52.4C268.1 1.7 260.4 0 256.4 0s-11.7 1.7-22.9 12.2c-11.4 10.6-23.7 28-35.1 52.4-20.3 43.5-34.6 102.9-37.5 167.4m-48 0c3.5-85.6 25.6-165.1 57.9-217.3C78.7 47.3 10.9 131.2 1.5 232zM1.5 280c9.4 100.8 77.2 184.7 169.3 217.3-32.3-52.2-54.4-131.7-57.9-217.3zm398.4 0c-3.5 85.6-25.6 165.1-57.9 217.3 92.1-32.7 159.9-116.5 169.3-217.3zm111.4-48C501.9 131.2 434.1 47.3 342 14.7c32.3 52.2 54.4 131.7 57.9 217.3z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["announce.dismiss", "content.code.copy", "navigation.footer", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado para \u00e1rea de transfer\u00eancia", "clipboard.copy": "Copiar para \u00e1rea de transfer\u00eancia", "search.result.more.one": "mais 1 nesta p\u00e1gina", "search.result.more.other": "# mais nesta p\u00e1gina", "search.result.none": "Nenhum documento encontrado", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Digite para iniciar a busca", "search.result.term.missing": "Ausente", "select.version": "Selecione a vers\u00e3o"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>